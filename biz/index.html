<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-KNL2VQN');</script>
  <!-- End Google Tag Manager -->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-218993952-1">
  </script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-218993952-1');

    if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('serviceWorker_biz.js')
      .then((reg) => {
        console.log('Service Worker Registered!', reg);
      });
    }
  </script>

  <title>아파트랭크BIZ</title>
  <meta property="og:type" content="website">
  <meta property="og:title" content="아파트랭크 BIZ">
  <meta property="og:description" content="아파트 분양 적합한 지역 찾기">
  <meta property="og:image" content="https://www.aptrank.kr/biz/thumbnail_biz2.png">
  <meta property="og:url" content="https://www.aptrank.kr/biz/">
  <meta name="keyword" content="부동산, 아파트, 입지, 순위, 아파트입지, 우리동네, 호가, 대장아파트, 최고가, 신고가, 호재, AI, 등수">
  <meta name="description" content="아파트 분양 적합한 지역 찾기">
  <meta name="author" content="아파트랭크">
  <meta name="robots" content="index,follow">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=yes, minimal-ui, viewport-fit=cover">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- 주소창 등의 웹 브라우저 UI를 표시하지 않기 -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <!-- 상태 바의 스타일을 지정 -->
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- 홈 화면에서 표시되는 앱 이름을 지정 -->
  <meta name="apple-mobile-web-app-title" content="아파트랭크BIZ">
  <!-- 홈 화면에서 표시되는 앱 아이콘을 지정 -->
  <link rel="apple-touch-icon" href="https://www.aptrank.kr/biz/apt-rank-biz-152x152.png">
  <!-- 웹 앱 매니페스트를 읽어 들이기 -->
  <link rel="manifest" href="manifest_biz.json">  

  <link rel="canonical" href="https://www.aptrank.kr/biz/">
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link rel="shortcut icon" href="https://www.aptrank.kr/biz/apt-rank-biz.png"/>


  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"  crossorigin="anonymous"></script>
  <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>


  <script src="../js/menu_select_box_BIZ.js" type="text/javascript"></script>
  <script src="../js/draw_chart_BIZ.js" type="text/javascript"></script>
  <script src="../js/sort.js" type="text/javascript"></script>
  <script src="../js/search.js" type="text/javascript"></script>  
  <script src="../js/share.js" type="text/javascript"></script>
  <script src="../js/distance.js" type="text/javascript"></script>
  <script src="../js/svg_region.js" type="text/javascript"></script>
  <script src="../js/BIZ_guide.js" type="text/javascript"></script>
  <script src="./ad_aptrank_biz.js" type="text/javascript"></script>

  <link href="./style_biz.css" rel="stylesheet"/>
  <link href="../css/slider.css" rel="stylesheet"/>
  <link href="../css/distance.css" rel="stylesheet"/>

  <script src="../js/doubleSlider.js" type="text/javascript"></script>
</head>
<style>
</style>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNL2VQN"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <!-- 타이틀 영역 -->
  <div id="titleBar_theme">
    <!--검색 버튼 표시-->
    <!-- <div id='help' style='font-size: 1.2em' onClick='share(shareTitle, shareText, shareURL)'><i class='fa-solid fa-arrow-up-right-from-square'></i></button></div> -->
    <!-- <div id="rearrange" class="position-relative" onClick='showRearrangeBar(this)'><i class="fa-solid fa-arrow-down-wide-short"></i></div> -->
    <div></div>
    <!--타이틀 표시-->
    <!-- <div id="title" onClick='window.location.reload()'>아파트랭크<span id="themeLogo">BIZ</span> X 파트너를 찾습니다!</div> -->
    <div id="title" onClick='window.location.reload()'>아파트랭크<span id="themeLogo">BIZ</span><span id="themeLogo">BETA</span><span style='font-weight:400; font-size: 0.85em'>  _www.aptrank.kr/biz</span></div>
    <div id="footer_text">Copyright 2022 | 아파트랭크BIZ | <a href="mailto:aptranking@gmail.com" style="text-decoration:None; color: white">협업/광고/제휴문의는 aptranking@gmail.com으로 문의해 주세요</a></div>
    <!--공유 버튼-->        
    <!-- <div id='tripGuide' data-bs-toggle='modal' data-bs-target='#toggleModal1' id='myModal' onClick='showDistance(routeArray)'><i class="fa-solid fa-route"></i></div> -->
    
    <!--단지 가중치 설정 버튼 표시-->        
    <!-- <div id='help' data-bs-toggle='modal' data-bs-target='#exampleModal' id='myModal' onClick='showNotice()'><i class="fa-solid fa-circle-question"></i></div> -->
    <div></div>
  </div>

  <div id="container">
    <div></div>
    <div id="centerBox">
      <!-- Vertically centered scrollable modal -->
        <!-- Button trigger modal -->
        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body" id='aptDetail'></div>
              <div id='footer'></div>
            </div>
          </div>
        </div>      

      <!--지도 표시 영역-->
      <div id="map_area">
        <div id="svg_map"></div>
        <!--Back 버튼 표시 영역: Absolute-->
        <div class="go_Korea" onClick="go_Korea()">
          <div><i class="fa-solid fa-arrow-left"></i></div>       
        </div>      
        <div id="legend_area">
          <div class="ledend_color"></div>
          <div class="ledend_color" style="background: #dddddd;"></div>
          <div class="ledend_color" style="background: #B80F0A;"></div>
          <div class="ledend_color" style="background: #F08080;"></div>
          <div class="ledend_color" style="background: #fcba03;"></div>
          <div class="ledend_color" style="background: #66d488;"></div>
          <div class="ledend_color" style="background: #13a140;"></div>          
          <div class="ledend_color"></div>
          <div class="ledend_text"></div>
          <div class="ledend_text">정보없음</div>
          <div class="ledend_text">매우나쁨</div>
          <div class="ledend_text">나쁨</div>
          <div class="ledend_text">보통</div>
          <div class="ledend_text">좋음</div>
          <div class="ledend_text">매우좋음</div>          
          <div class="ledend_text"></div>
        </div>

        <div id = "financials">
          <div></div>
          <div id = "PIR_area">
            <div class="PIR_BP_title">PIR<span style="font-size: 0.9em"> (소득으로 주택매수 가능연한)</span></div>
            <div id='PIR_table'>              
              <div id = "PIR_ago2_value"></div>
              <div id = "PIR_ago1_value"></div>
              <div id = "PIR_recent_value"></div>
              <div id = "PIR_ago2"></div>
              <div id = "PIR_ago1"></div>
              <div id = "PIR_recent"></div>
            </div>
          </div>

          <div id = "BP_area">
            <div class="PIR_BP_title">주택구입 부담지수<span style="font-size: 0.9em"> (대출상환 부담강도)</span></div>
            <div id='BP_table'>              
              <div id = "BP_ago2_value"></div>
              <div id = "BP_ago1_value"></div>
              <div id = "BP_recent_value"></div>
              <div id = "BP_ago2"></div>
              <div id = "BP_ago1"></div>
              <div id = "BP_recent"></div>
            </div>
          </div>
          <div></div>
        </div>

        <!--기준 금리 표시 영역: Absolute-->
        <div id="standatd_interest">
          <div style="border-bottom: 1px solid #ddd">한국 기준금리</div><div id="interest_ko" style="border-bottom: 1px solid #ddd; text-align: right;"></div>
          <div>미국 기준금리</div><div id="interest_us" style="text-align: right"></div>          
        </div>
      </div>      

      <!--리스트 데이터 붙여넣는 영역-->
      <div id='contentBox'>
        <div id="themeSelections">        
          <div id="sido_selection"><select id="sido" onChange="sidoChange()"></select></div>
          <div id="gungu_selection" style="width: 330px"><select id="gungu" onChange="updateRegion()"></select></div>          
          <div id="update_info">업데이트 : 2023-04-05 <br> (2023년 2월 데이터 기준) </div>
          <div id="go_to_aptrank" onClick="openAptrank()"></div>
          <div id='bizCal' onClick="openURL('https://www.aptrank.kr/priceCal')"><button type='button' class='goApt' style='font-size: 0.95em; height: 46px'><i class="fa-solid fa-calculator"></i> 분양가 계산기</button></div>
          <div id='bizShare'></div>
        </div>
        <div id="dataWrapper">
          <div id="dataList"></div>
        </div>
      </div>
    </div>
    
    <div></div>
  </div>

  <!--
  <div id="footer_area">
    <div></div>
    <div id="footer_text">Copyright 2022 | 아파트랭크BIZ | <a href="mailto:aptranking@gmail.com" style="text-decoration:None; color: white">aptranking@gmail.com  </a></div>
    <div></div>
  </div>
  -->
  <div id="footer_area">
    <div></div>
    <div style="height: 3px; background: #162235;"></div>
    <div></div>
    
    <div></div>
    <div id='partnership'>
      <div id="part0"></div>
      <div id="part1"></div>
      <div id="part2"></div>
      <div id="part3"></div>
      <div id="part4"></div>      
    </div>
    <div></div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.0/dist/chart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

</body>

<script>
  var selectedRegion = "Korea"
  var selectedSubRegion = "1000000000_Korea"
  var selectedTheme = "under100M"  

  var regionName = ""

  var linked = ""
  var regionValue = ""

  var itemNum = 0;
  var aptData = "";
  var prev_subRegion = ""
  var very_good = {'min':70, 'max':100}
  var good = {'min':55, 'max':70}
  var normal = {'min':40, 'max':55}
  var bad = {'min':20, 'max':40}
  var very_bad = {'min':0, 'max':20}

  var today = new Date()
  var today_year = today.getFullYear();
  var today_month = dateReturn( (today.getMonth() + 1))
  var today_day = dateReturn( today.getDate() );
  var today_num = Number(today_year + today_month + today_day)
  var today_str = today_year + "-" + today_month + "-" + today_day

  function dateReturn(n){
    return n<10 ? "0"+n : n
  }  

  var broswerInfo = navigator.userAgent;  

  $(document).ready(function(){

    Kakao.init(kakaoKey);

    var option = ""
    for(i = 0 ; i < regions.length ; i++){
        option += "<option value='" + regions[i][1] + "'>" + regions[i][0] + "</option>"
    }
    $('#sido').html(option)

    var lastRegion = localStorage.getItem('lastRegion')
    var lastSubRegion = localStorage.getItem('lastSubRegion')
    var lastTheme = localStorage.getItem('lastTheme')
    var lastNoticed = localStorage.getItem('lastNoticed')        

    var lastRegion = sessionStorage.getItem('lastRegion')
    var lastSubRegion = sessionStorage.getItem('lastSubRegion')
    var lastMonth = sessionStorage.getItem('lastMonth')

    const url = new URL(window.location.href)
    const urlParams = url.searchParams
    console.log(urlParams)

    if(urlParams.has('reg')){
      console.log(urlParams.get('reg'))
      selectedRegion = urlParams.get('reg')
    }
    else if(lastRegion != null){
      selectedRegion = lastRegion
    }

    if(urlParams.has('sub')){
      console.log(urlParams.get('sub'))
      selectedSubRegion = urlParams.get('sub')
    }
    else if(lastSubRegion != null){
      selectedSubRegion = lastSubRegion
    }

    $("#sido").val(selectedRegion).prop("selected", true);
    regionName = $("#sido option:selected").val();

    $('#themeDataList').html("");

    optionChange(selectedSubRegion)
    updateRegion()

    loadStandardInterest_KO()
    loadStandardInterest_US()

    loadPIR(regionName)
    loadBP(regionName)

    $('div.modal').on('show.bs.modal', function() {
      var modal = this;
      var hash = modal.id;
      window.location.hash = hash;
      window.onhashchange = function() {
        if (!location.hash){
          $(modal).modal('hide');
        }
      }
    });

    if(broswerInfo.indexOf("inApp")>-1){
      shareHtml = "<div class='bShare' onClick='kakaoShare(shareTitle, shareText, shareURL)'><img src=\"kakao_icon.png\" height=\"30px\"/>&nbsp공유</div>"
    }
    else{      
      shareHtml = "<div class='bShare' onClick='share(shareTitle, shareText, shareURL)'><button type='button' class='goApt' style='font-size: 0.95em; height: 46px'><i class='fa-solid fa-up-right-from-square'></i> 공유</button></div>"      
    }
    $('#bizShare').html(shareHtml)    

  });

  function openURL(url){    
    window.open(url)
  }

  function loadStandardInterest_KO(){
    url = "https://www.aptrank.kr/BOK_standatd_interest.json"
    $.getJSON(url, function(json) {
        ko_interest = json;
        time_obj = ko_interest['TIME']
        data_obj = ko_interest['DATA_VALUE']
        
        interest = Object.values(data_obj)
        update_time = Object.values(time_obj)
        ko_interest = Number(interest[interest.length-1])
        $('#interest_ko').html(ko_interest.toFixed(2) + "%")
    })
  }

  function loadStandardInterest_US(){
    url = "https://www.aptrank.kr/FED_standatd_interest.json"
    $.getJSON(url, function(json) {
        us_interest = json;
        time_obj = us_interest['DATE']
        data_obj = us_interest['INTEREST']
        
        interest = Object.values(data_obj)
        update_time = Object.values(time_obj)        
        us_interest = Number(interest[interest.length-1])
        $('#interest_us').html(us_interest.toFixed(2) + "%")
    })
  }

  function loadPIR(loc){
    url = "https://www.aptrank.kr/PIR.json"
    $.getJSON(url, function(json) {
        PIR_list = json;
        PIR_locations = Object.values(PIR_list['Location'])
        PIR_key_list = Object.keys(PIR_list)
        PIR_recent = Object.values(PIR_list[PIR_key_list[2]])
        PIR_ago1 = Object.values(PIR_list[PIR_key_list[1]])
        PIR_ago2 = Object.values(PIR_list[PIR_key_list[0]])

        found_index = PIR_locations.indexOf(loc)

        $('#PIR_ago2_value').html(PIR_ago2[found_index])
        $('#PIR_ago1_value').html(PIR_ago1[found_index])
        if(Number(PIR_recent[found_index]) == 0){
          $('#PIR_recent_value').html("정보없음")
        }
        else{
          $('#PIR_recent_value').html(PIR_recent[found_index] + "년")
        }
        
        
        $('#PIR_ago2').html("(" + PIR_key_list[0].substr(0, 4) + "-" + PIR_key_list[0].substr(4, 2) + ")")
        $('#PIR_ago1').html("(" + PIR_key_list[1].substr(0, 4) + "-" + PIR_key_list[1].substr(4, 2) + ")")
        $('#PIR_recent').html("(" + PIR_key_list[2].substr(0, 4) + "-" + PIR_key_list[2].substr(4, 2) + ")")  
    })
  }
  function loadBP(loc){
    url = "https://www.aptrank.kr/BP.json"
    $.getJSON(url, function(json) {
        BP_list = json;
        BP_locations = Object.values(BP_list['Location'])
        BP_key_list = Object.keys(BP_list)
        BP_recent = Object.values(BP_list[BP_key_list[1]])
        BP_ago1 = Object.values(BP_list[BP_key_list[2]])
        BP_ago2 = Object.values(BP_list[BP_key_list[3]])

        found_index = BP_locations.indexOf(loc)
        //console.log(BP_list)
        //console.log(BP_key_list)
        //console.log(BP_recent[found_index], BP_ago1[found_index], BP_ago2[found_index])

        $('#BP_ago2_value').html(BP_ago2[found_index])
        $('#BP_ago1_value').html(BP_ago1[found_index])
        $('#BP_recent_value').html(BP_recent[found_index] + "%")   
        
        $('#BP_ago2').html("(" + BP_key_list[3].substr(3, 4) + "-" + BP_key_list[3].substr(8, 2) + ")")
        $('#BP_ago1').html("(" + BP_key_list[2].substr(3, 4) + "-" + BP_key_list[2].substr(8, 2) + ")")
        $('#BP_recent').html("(" + BP_key_list[1].substr(3, 4) + "-" + BP_key_list[1].substr(8, 2) + ")")
    })
  }

  function sidoChange(){
    optionChange()
    updateRegion()
  }

  function saveLocalStorage(){
    localStorage.setItem('lastRegion', selectedRegion)
    localStorage.setItem('lastSubRegion', selectedSubRegion)
    localStorage.setItem('lastTheme', selectedTheme)
  }

  function scrollUp(){
    $( 'html, body' ).animate( { scrollTop : 0 }, 50 );
  }

  function optionChange(subRegion){
    selectedSubRegion = subRegion
    regionName = $("#sido option:selected").val();
    selectedRegion = regionName
    var changeItem    
    if(regionName == 'Korea'){
      changeItem = inKorea      
    }
    if(regionName == 'Seoul'){
      changeItem = inSeoul
    }
    if(regionName == 'Busan'){
      changeItem = inBusan
    }
    if(regionName == 'Incheon'){
      changeItem = inIncheon
    }
    if(regionName == 'Daegu'){
      changeItem = inDaegu
    }
    if(regionName == 'Gwangju'){
      changeItem = inGwangju
    }
    if(regionName == 'Daejeon'){
      changeItem = inDaejeon
    }
    if(regionName == 'Ulsan'){
      changeItem = inUlsan
    }
    if(regionName == 'Sejong'){
      changeItem = inSejong
    }
    if(regionName == 'Gyeonggi'){
      changeItem = inGyeonggi
    }
    if(regionName == 'Gangwondo'){
      changeItem = inGangwondo
    }
    if(regionName == 'Chungcheongbukdo'){
      changeItem = inChungcheongbukdo
    }
    if(regionName == 'Chungcheongnamdo'){
      changeItem = inChungcheongnamdo
    }
    if(regionName == 'Jeollabukdo'){
      changeItem = inJeollabukdo
    }
    if(regionName == 'Jeollanamdo'){
      changeItem = inJeollanamdo
    }
    if(regionName == 'Gyeongsangbukdo'){
      changeItem = inGyeongsangbukdo
    }
    if(regionName == 'Gyeongsangnamdo'){
      changeItem = inGyeongsangnamdo
    }
    if(regionName == 'Jejudo'){
      changeItem = inJejudo
    }
    $('#gungu').empty();

    if(selectedRegion == "Korea"){
      $('.go_Korea').css('visibility', 'hidden')
    }
    else{
      $('.go_Korea').css('visibility', 'visible')
    }

    for(var i = 0 ; i < changeItem.length; i++){
      var subOption = $("<option value='" + changeItem[i][1] + "'>" + changeItem[i][0] + "</option>")
      $('#gungu').append(subOption);
    }    

    if(selectedSubRegion == undefined){
      $("#gungu").val(changeItem[0][1]).prop("selected", true);
      selectedSubRegion = $("#gungu option:selected").val()
    }
    else{
      $("#gungu").val(selectedSubRegion).prop("selected", true);      
    }
    updateRegion()    
  }  

  function updateRegion(){
    var selection = document.getElementById("gungu")
    selectedRegion = $("#sido option:selected").val()
    selectedSubRegion = $("#gungu option:selected").val()    
    updateTable()
    regionName = $("#sido option:selected").text()

    loadPIR(regionName)
    loadBP(regionName)    
  }

  function updateTable(){
    $('div.modal').modal("hide");
    //$('#sort').css("visibility", "visible")
    $('html').scrollTop(0)    
    
    //url = "https://www.aptrank.kr/biz/" + region + ".json"
    //url = "https://www.aptrank.kr/biz/Location_Build_Valuated.json"
    url = "https://www.aptrank.kr/biz/BIZ_Valuated_202302.json"
    //url = "./BIZ_Valuated_202207_01.json"

    $.getJSON(url, function(json) {
        //console.log(json);
        aptData = json;         
        //sortData = json;
        //itemNum = json.data.length;

        ListUp(aptData.data)
        region_coloring(aptData.data)
  })}

function go_Korea(){    
  goRegion = ""
  if(selectedSubRegion == "4128100000_Gyeonggi_Goyang_Deogyang" || selectedSubRegion == "4128500000_Gyeonggi_Goyang_Ilsandong" || selectedSubRegion == "4128700000_Gyeonggi_Goyang_Ilsanseo"){
    goRegion = "4128000000_Gyeonggi_Goyang"
  }
  else if(selectedSubRegion == "4113500000_Gyeonggi_Seongnam_Bundang" || selectedSubRegion == "4113100000_Gyeonggi_Seongnam_Sujeong" || selectedSubRegion == "4113300000_Gyeonggi_Seongnam_Jungwon"){
    goRegion = "4113000000_Gyeonggi_Seongnam"
  }
  else if(selectedSubRegion == "4111300000_Gyeonggi_Suwon_Gwonseon" || selectedSubRegion == "4111700000_Gyeonggi_Suwon_Yeongtong" || selectedSubRegion == "4111100000_Gyeonggi_Suwon_Jangan" || selectedSubRegion == "4111500000_Gyeonggi_Suwon_Paldal" ){
    goRegion = "4111000000_Gyeonggi_Suwon"
  }
  else if(selectedSubRegion == "4127300000_Gyeonggi_Ansan_Danwon" || selectedSubRegion == "4127100000_Gyeonggi_Ansan_Sangnok"){
    goRegion = "4127000000_Gyeonggi_Ansan"
  }
  else if(selectedSubRegion == "4117300000_Gyeonggi_Anyang_Dongan" || selectedSubRegion == "4117100000_Gyeonggi_Anyang_Manan"){
    goRegion = "4117000000_Gyeonggi_Anyang"
  }
  else if(selectedSubRegion == "4146300000_Gyeonggi_Yongin_Giheung" || selectedSubRegion == "4146500000_Gyeonggi_Yongin_Suji" || selectedSubRegion == "4146100000_Gyeonggi_Yongin_Cheoin"){
    goRegion = "4146000000_Gyeonggi_Yongin"
  }
  else {      
    goRegion = "Korea"      
  }
  changeRegion(goRegion)
}
  
function region_coloring(regionData){
  search_array = []

  if(selectedRegion == "Korea"){
    $('#svg_map').html(svg_Korea)
    $('#svg_map .TEXT').css("font-size", "0.9em")
    search_array = regions
  }
  if(selectedRegion == "Seoul"){
    $('#svg_map').html(svg_Seoul)
    $('#svg_map .TEXT').css("font-size", "0.8em")
    search_array = inSeoul
  }
  if(selectedRegion == "Incheon"){
    $('#svg_map').html(svg_Incheon)
    $('#svg_map .TEXT').css("font-size", "0.8em")
    search_array = inIncheon
  }
  if(selectedRegion == "Gyeonggi"){
    search_array = inGyeonggi
    if(selectedSubRegion == "4128100000_Gyeonggi_Goyang_Deogyang" || selectedSubRegion == "4128500000_Gyeonggi_Goyang_Ilsandong" || selectedSubRegion == "4128700000_Gyeonggi_Goyang_Ilsanseo"
       || selectedSubRegion == "4113500000_Gyeonggi_Seongnam_Bundang" || selectedSubRegion == "4113100000_Gyeonggi_Seongnam_Sujeong" || selectedSubRegion == "4113300000_Gyeonggi_Seongnam_Jungwon" 
       || selectedSubRegion == "4111300000_Gyeonggi_Suwon_Gwonseon" || selectedSubRegion == "4111700000_Gyeonggi_Suwon_Yeongtong" || selectedSubRegion == "4111100000_Gyeonggi_Suwon_Jangan" || selectedSubRegion == "4111500000_Gyeonggi_Suwon_Paldal" 
       || selectedSubRegion == "4127300000_Gyeonggi_Ansan_Danwon" || selectedSubRegion == "4127100000_Gyeonggi_Ansan_Sangnok" 
       || selectedSubRegion == "4117300000_Gyeonggi_Anyang_Dongan" || selectedSubRegion == "4117100000_Gyeonggi_Anyang_Manan" 
       || selectedSubRegion == "4146300000_Gyeonggi_Yongin_Giheung" || selectedSubRegion == "4146500000_Gyeonggi_Yongin_Suji" || selectedSubRegion == "4146100000_Gyeonggi_Yongin_Cheoin" ){
        $('#svg_map').html(svg_Gyeonggi_detail)
    }
    else{
      $('#svg_map').html(svg_Gyeonggi)
    }
    $('#svg_map .TEXT').css("font-size", "0.8em")
  }
  if(selectedRegion == "Busan"){
    $('#svg_map').html(svg_Busan)
    $('#svg_map .TEXT').css("font-size", "0.8em")
    search_array = inBusan
  }
  if(selectedRegion == "Daegu"){
    $('#svg_map').html(svg_Daegu)
    $('#svg_map .TEXT').css("font-size", "0.9em")
    search_array = inDaegu
  }
  if(selectedRegion == "Gwangju"){
    $('#svg_map').html(svg_Gwangju)
    $('#svg_map .TEXT').css("font-size", "1em")
    search_array = inGwangju
  }
  if(selectedRegion == "Daejeon"){
    $('#svg_map').html(svg_Daejeon)
    $('#svg_map .TEXT').css("font-size", "1em")
    search_array = inDaejeon
  }
  if(selectedRegion == "Ulsan"){
    $('#svg_map').html(svg_Ulsan)
    $('#svg_map .TEXT').css("font-size", "1em")
    search_array = inUlsan
  }
  if(selectedRegion == "Sejong"){
    $('#svg_map').html(svg_Sejong)
    $('#svg_map .TEXT').css("font-size", "1.5em")
    search_array = inSejong
  }
  if(selectedRegion == "Jejudo"){
    $('#svg_map').html(svg_Jejudo)
    $('#svg_map .TEXT').css("font-size", "1.3em")
    search_array = inJejudo
  }
  if(selectedRegion == "Gangwondo"){
    $('#svg_map').html(svg_Gangwondo)
    $('#svg_map .TEXT').css("font-size", "0.9em")
    search_array = inGangwondo
  }
  if(selectedRegion == "Chungcheongbukdo"){
    $('#svg_map').html(svg_Chungcheongbukdo)
    $('#svg_map .TEXT').css("font-size", "0.9em")
    search_array = inChungcheongbukdo
  }
  if(selectedRegion == "Chungcheongnamdo"){
    $('#svg_map').html(svg_Chungcheongnamdo)
    $('#svg_map .TEXT').css("font-size", "0.9em")
    search_array = inChungcheongnamdo
  }
  if(selectedRegion == "Jeollabukdo"){
    $('#svg_map').html(svg_Jeollabukdo)
    $('#svg_map .TEXT').css("font-size", "0.9em")
    search_array = inJeollabukdo
  }
  if(selectedRegion == "Jeollanamdo"){
    $('#svg_map').html(svg_Jeollanamdo)
    $('#svg_map .TEXT').css("font-size", "0.9em")
    search_array = inJeollanamdo
  }
  if(selectedRegion == "Gyeongsangbukdo"){
    $('#svg_map').html(svg_Gyeongsangbukdo)
    $('#svg_map .TEXT').css("font-size", "0.9em")
    search_array = inGyeongsangbukdo
  }
  if(selectedRegion == "Gyeongsangnamdo"){
    $('#svg_map').html(svg_Gyeongsangnamdo)
    $('#svg_map .TEXT').css("font-size", "0.9em")
    search_array = inGyeongsangnamdo
  }

  $('#svg_map .TEXT').css("fill", "#aaa")  

  pointed_region = selectedSubRegion + "z"
  pointed_text = "txt_" + selectedSubRegion + "z"
  
  for (i = 0 ; i < search_array.length ; i++){    
      searching_region = search_array[i][1]
      for (j = 0 ; j < regionData.length ; j++){
        if(searching_region == regionData[j]['Link']){
          score = regionData[j]['총점'][0][0]          
          //score = Math.floor(Math.random() * 101)
          finds = "#svg_map #" + searching_region          
          if(score >= very_bad['min'] && score <= very_bad['max']){ $(finds).css("fill", "#B80F0A"); $(finds).css("fill-opacity", "0.6") }
          else if(score > bad['min'] && score <= bad['max']){ $(finds).css("fill", "#F08080"); $(finds).css("fill-opacity", "0.6") }
          else if(score > normal['min'] && score <= normal['max']){ $(finds).css("fill", "#fcba03"); $(finds).css("fill-opacity", "0.6") }
          else if(score > good['min'] && score <= good['max']){ $(finds).css("fill", "#66d488"); $(finds).css("fill-opacity", "0.6")  }
          else if(score > very_good['min'] && score <= very_good['max']){ $(finds).css("fill", "#13a140"); $(finds).css("fill-opacity", "0.6")  }

          find_text = "#svg_map #txt_" + searching_region
          $(find_text).css("fill", "#000")

          if(searching_region != selectedSubRegion){
            $(finds).hover(function(){            
              $(this).css("fill-opacity", "1");
            }, function(){            
              $(this).css("fill-opacity", "0.6");
            })
            $(finds).click(function(){
              changeRegion(this.id)
            })
          }
          else{
            if(selectedSubRegion == "4113000000_Gyeonggi_Seongnam" || selectedSubRegion == "4128000000_Gyeonggi_Goyang" || selectedSubRegion == "4111000000_Gyeonggi_Suwon"
                || selectedSubRegion == "4127000000_Gyeonggi_Ansan" || selectedSubRegion == "4117000000_Gyeonggi_Anyang" || selectedSubRegion == "4146000000_Gyeonggi_Yongin"){
                $(finds).hover(function(){            
                $(this).css("fill-opacity", "1");
              }, function(){            
                $(this).css("fill-opacity", "1");
              })
              $(finds).click(function(){
                if(selectedSubRegion == "4113000000_Gyeonggi_Seongnam"){ changeRegion('4113500000_Gyeonggi_Seongnam_Bundang') }
                if(selectedSubRegion == "4128000000_Gyeonggi_Goyang"){ changeRegion('4128700000_Gyeonggi_Goyang_Ilsanseo') }
                if(selectedSubRegion == "4111000000_Gyeonggi_Suwon"){ changeRegion('4111700000_Gyeonggi_Suwon_Yeongtong') }
                if(selectedSubRegion == "4127000000_Gyeonggi_Ansan"){ changeRegion('4127300000_Gyeonggi_Ansan_Danwon') }
                if(selectedSubRegion == "4117000000_Gyeonggi_Anyang"){ changeRegion('4117300000_Gyeonggi_Anyang_Dongan') }
                if(selectedSubRegion == "4146000000_Gyeonggi_Yongin"){ changeRegion('4146500000_Gyeonggi_Yongin_Suji') }
              })

              let svg = document.querySelector("svg");
              selected_region = document.getElementById(selectedSubRegion)
              selected_region_copy = selected_region
              selected_region_copy.id = pointed_region
              $("#" + pointed_region).css("stroke", "rgba(0, 64, 255, 0.7)")
              $("#" + pointed_region).css("stroke-width", "5")
              $("#" + pointed_region).css("fill-opacity", "1")
              svg.appendChild(selected_region_copy);

              selected_region_text = document.getElementById("txt_" + selectedSubRegion)            
              selected_region_text_copy = selected_region_text
              selected_region_text_copy.id = pointed_text  
              
              svg.appendChild(selected_region_text_copy);
            }
            else{
              let svg = document.querySelector("svg");
              selected_region = document.getElementById(selectedSubRegion)
              selected_region_copy = selected_region
              selected_region_copy.id = pointed_region
              $("#" + pointed_region).css("stroke", "rgba(0, 64, 255, 0.7)")
              $("#" + pointed_region).css("stroke-width", "5")
              $("#" + pointed_region).css("fill-opacity", "1")
              svg.appendChild(selected_region_copy);

              selected_region_text = document.getElementById("txt_" + selectedSubRegion)            
              selected_region_text_copy = selected_region_text
              selected_region_text_copy.id = pointed_text  
              
              svg.appendChild(selected_region_text_copy);
            }
            
          }
        }
    }
  }

}

function set_text_color(txt){
  color_code = ""
  if(txt == "강한 상승" || txt == "매우좋음"){
    color_code = "#06d151"
  }
  if (txt == "약한 상승" || txt == "상승 전환" || txt == "좋음"){
    color_code = "#36c97b"
  }
  if (txt == "보합" || txt == "보통"){
    color_code = "#e89b02"
  }
  if (txt == "약한 하락" || txt == "하락 전환" || txt == "나쁨"){
    color_code = "#e6543e"
  }
  if (txt == "강한 하락" || txt == "매우나쁨"){
    color_code = "#d92004"
  }
  return color_code
}

function set_color(score){
  color_code = ""
  if(score > very_good['min']){
    color_code = "#13a140"
  }
  else if (score <= good['max'] && score > good['min']){
    color_code = "#66d488"
  }
  else if (score <= normal['max'] && score > normal['min']){
    color_code = "#fcba03"
  }
  else if (score <= bad['max'] && score > bad['min']){
    color_code = "#F08080"
  }
  else if (score <= very_bad['max'] && score >= very_bad['min']){
    color_code = "#B80F0A"
  }

  return color_code
}

function set_status(score){
  status = ""
  if(score > very_good['min']){
    status = "매우좋음"
  }
  else if (score <= good['max'] && score > good['min']){
    status = "좋음"
  }
  else if (score <= normal['max'] && score > normal['min']){
    status = "보통"
  }
  else if (score <= bad['max'] && score > bad['min']){
    status = "나쁨"
  }
  else if (score <= very_bad['max'] && score >= very_bad['min']){
    status = "매우나쁨"
  }

  return status
}

function changeRegion(sido){
  find_length = sido.split("_")

  if( find_length.length > 1 ){
    selectedSubRegion = sido
    selectedRegion = (sido.split("_"))[1]    
    optionChange(selectedSubRegion)
  }
  else{
    selectedRegion = sido
    $('#sido').val(selectedRegion).prop("selected", true)
    optionChange()
  }  
}

function ListUp(listData){  
  $('html').scrollTop(0)    
  $('#dataList').html("");

  //광고정보 로딩
  part_url = "https://www.aptrank.kr/ad/biz_partnership.json"
    $.ajaxSetup({ async: false });
    $.getJSON(part_url, function(part_json) {
        partData = part_json;
        part_detail = partData.data
        for( var p = 0 ; p < part_detail.length; p++){
          shop_name = part_detail[p]['shop_name']          
          part_sDate = part_detail[p]['start_date']
          part_sDate_Num = Number(part_sDate.replace(/-/gi, ""))
          part_eDate = part_detail[p]['end_date']
          part_eDate_Num = Number(part_eDate.replace(/-/gi, ""))          
          partDivID = "#part" + p
          if(today_num >= part_sDate_Num && today_num <= part_eDate_Num){
            gtag('event','파트너쉽노출', { 'event_category' : 'View_Partnership', 'event_label' : "아파트랭크BIZ," + today_str + "," + shop_name + ",뷰,파트너쉽"});
            page_url = part_detail[p]['homepage']
            part_image = part_detail[p]['icon']
            $(partDivID).html(part_biz);
            $('.partBox').html('<img src=../ad/image/' + part_image + '>')
            $('.partBox').click(function(){
              gtag('event','파트너쉽선택', { 'event_category' : 'Click_Partnership', 'event_label' : "아파트랭크BIZ," + today_str + "," + shop_name + ",클릭,파트너쉽"});
              window.open(page_url)
            })
          }
          else{
            $(partDivID).html(part_default);  
          }
        }
    })
    $.ajaxSetup({ async: true });

  var addon_html = ""     
  if(selectedRegion == 'Korea'){
    //$('#dataList').css("display", "grid")
    //$('#dataList').css("grid-template-columns", "1fr")
    //아파트랭크 연결 버튼
    var aptrank_link = "<div><img src = './icon_apt_rank.png' width='40px' height='40px'></div>"
            + "<div style='padding-left: 8px;'>전국 시도 <br> 아파트랭크 정보 보기</div>"
            + "<div style='text-align:center; font-size: 1.5em; line-height: 2em'><i class='fa-solid fa-circle-chevron-right'></i></div>"        
    $('#go_to_aptrank').html(aptrank_link)

    shareTextSum = ""

    addon_html += "<div id='table_index'>"
      addon_html += "<div style='grid-column: 1; grid-row: 1/span 2; border-right: 1px solid #ccc'></div>"
       + "<div style='grid-column: 2 / span 2; border-right: 1px solid #ccc; border-bottom: 1px solid #ccc'>인구</div>"
       + "<div style='grid-column: 4 / span 2; border-right: 1px solid #ccc; border-bottom: 1px solid #ccc'>거래량</div>"
       + "<div style='grid-column: 6 / span 2; border-right: 1px solid #ccc; border-bottom: 1px solid #ccc'>가격 (3개월 대비)</div>"
       + "<div style='grid-column: 8 / span 2; border-right: 1px solid #ccc; border-bottom: 1px solid #ccc'>공급</div>"
       + "<div style='grid-column: 10 / span 2; border-right: 1px solid #ccc; border-bottom: 1px solid #ccc'>미분양</div>"
       + "<div style='grid-column: 12; grid-row: 1/span 2; border-right: 1px solid #ccc;'>지역구 현황</div>"       
      addon_html += "<div style='border-right: 1px solid #ccc'>총인구</div>" + "<div style='border-right: 1px solid #ccc'>3년 대비</div>"
      addon_html += "<div style='border-right: 1px solid #ccc'>당월</div>" + "<div style='border-right: 1px solid #ccc'>10년평균대비</div>"
      addon_html += "<div style='border-right: 1px solid #ccc'>매매</div>" + "<div style='border-right: 1px solid #ccc'>전세</div>"
      addon_html += "<div style='border-right: 1px solid #ccc'>당해</div>" + "<div style='border-right: 1px solid #ccc'>적정공급 대비</div>"
      addon_html += "<div style='border-right: 1px solid #ccc'>당월</div>" + "<div style='border-right: 1px solid #ccc'>위험수준</div>"
    addon_html += "</div>"

    for(i = 0; i < listData.length; i++){
      var compare_link = listData[i]["Link"]      
      
      for(j = 1; j <regions.length; j++){
        if(compare_link == regions[j][1]){            
            var region_name = listData[i]["시군구"]
            var color_status = listData[i]["평점"]            
            
            var pop_info = listData[i]["인구정보"]
            var pop_rate = listData[i]["인구상승률"]
            var pop_score = listData[i]["인구점수"]
            var pop_nearby = listData[i]["인근지역통합정보"]

            var sales_info = listData[i]["매매가현황"]
            var sales_rate = listData[i]["매매상승률"]          
            var sales_score = listData[i]["매매점수"]

            var rent_info = listData[i]["전세가현황"]
            var rent_rate = listData[i]["전세상승률"] 

            var price_per_py = listData[i]["평단가"]

            var build_year = listData[i]["년차"]

            var non_sales = listData[i]["미분양현황"]

            var rent_ratio = listData[i]["전세가율"]
            var rent_score = listData[i]["전세점수"]

            var supply_volume = listData[i]["입주물량"]
            var supply_new_volume = listData[i]["분양물량"]
            var supply_proper = listData[i]["적정공급물량"]
            var supply_score = listData[i]["공급량점수"]

            var deal_info = listData[i]["거래량현황"]
            var deal_score = listData[i]["거래량점수"]

            var regulation_info = listData[i]["규제현황"]

            var total_score = listData[i]["총점"]
            var sido_id = compare_link
            var sURL = listData[i]["sURL"]

            //$('#dataList').css('row-gap', '0.25em')

            addon_html += "<div class='region_info' id='" + sido_id + "' onClick='changeRegion(this.id)'>"              
              addon_html += "<div class = 'region_table1'>"

                supply_plus_minus = supply_proper - (supply_volume[0] - supply_new_volume[0])
                if(supply_plus_minus < 0){ supply_pm =  Math.abs(supply_plus_minus*-1).toLocaleString() + " 과다"}
                if(supply_plus_minus >= 0){ supply_pm =  Math.abs(supply_plus_minus).toLocaleString() + " 부족"}

                //인구
                pop_rate_3y = Number(pop_rate[4]).toFixed(2)
                if(pop_rate_3y < 0){ pop_rate_3y = "<span style='color:blue'>▼" + (pop_rate_3y)*-1 + "% </span>" } else{ pop_rate_3y = "<span style='color:#fe4040'>▲" + (pop_rate_3y) + "% </span>" }

                addon_html += "<div class='region_name' style='border-right: 1px solid #ddd;'>" + "<span style='color:" + set_color(total_score[0][0]) +"'>●</span>" + " " + region_name + "</div>"
                addon_html += "<div style='text-align: right; padding-right: 15px'>" + pop_info[0][0].toLocaleString() +"명</div>"
                              + "<div style='border-right: 1px solid #ddd; '>" + pop_rate_3y + "</div>"

                //거래량                
                deal_10y_avg = Number( Number(deal_info[0]).toFixed(0) ).toLocaleString() + "건"
                deal_current = Number(deal_info[1]).toLocaleString() + "건"
                deal_rate = ((deal_info[1]/deal_info[0])*100).toFixed(2) + "%"

                addon_html += "<div style='text-align: right; padding-right: 15px'>" + deal_current + "</div>"
                              + "<div style='border-right: 1px solid #ddd'>" + deal_rate + "</div>"

                //가격
                sales_rate_3m = Number(sales_rate[2]).toFixed(2)
                if(sales_rate_3m < 0){ sales_rate_3m = "<span style='color:blue'>▼" + (sales_rate_3m)*-1 + "% </span>" } else{ sales_rate_3m = "<span style='color:#fe4040'>▲" + (sales_rate_3m) + "% </span>" }
                rent_rate_3m = Number(rent_rate[2]).toFixed(2)
                if(rent_rate_3m < 0){ rent_rate_3m = "<span style='color:blue'>▼" + (rent_rate_3m)*-1 + "% </span>" } else{ rent_rate_3m = "<span style='color:#fe4040'>▲" + (rent_rate_3m) + "% </span>" }

                addon_html += "<div>" + sales_rate_3m + "</div>"
                              + "<div style='border-right: 1px solid #ddd'>" + rent_rate_3m + "</div>"

                //공급                
                supply_volume_this_year = Number(supply_volume[0]+supply_new_volume[0]).toLocaleString() + "세대"
                supply_volume_plus_minus = supply_proper - (supply_volume[0]+supply_new_volume[0])
                if(supply_volume_plus_minus < 0){
                  supply_volume_plus_minus = (supply_volume_plus_minus * -1).toLocaleString() + " 과다"
                }
                else{
                  supply_volume_plus_minus = supply_volume_plus_minus.toLocaleString() + " 부족"
                }

                addon_html += "<div style='text-align: right; padding-right: 15px'>" + supply_volume_this_year + "</div>"
                              + "<div style='border-right: 1px solid #ddd; text-align: right; padding-right: 15px;'>" + supply_volume_plus_minus + "</div>"

                //미분양                
                non_sales_this = Number( Number(non_sales[1]).toFixed(0) ).toLocaleString() + "세대"

                addon_html += "<div style='text-align: right; padding-right: 15px'>" + non_sales_this + "</div>"
                              + "<div style='border-right: 1px solid #ddd;'>" + non_sales[0] + "</div>"

                //지역구 현황
                addon_html += "<div class='region_status'>"                  
                  addon_html += "<div class='subregion_traffic'><span style='color:#13a140'>●</span></div>" + "<div class='subregion_num'>" + color_status[0][0] + "</div>"
                  addon_html += "<div class='subregion_traffic'><span style='color:#66d488'>●</span></div>" + "<div class='subregion_num'>" + color_status[1][0] + "</div>"
                  addon_html += "<div class='subregion_traffic'><span style='color:#fcba03'>●</span></div>" + "<div class='subregion_num'>" + color_status[2][0] + "</div>"
                  addon_html += "<div class='subregion_traffic'><span style='color:#F08080'>●</span></div>" + "<div class='subregion_num'>" + color_status[3][0] + "</div>"
                  addon_html += "<div class='subregion_traffic'><span style='color:#B80F0A'>●</span></div>" + "<div class='subregion_num'>" + color_status[4][0] + "</div>"
                  addon_html += "<div class='subregion_traffic'><span style='color:#dddddd'>●</span></div>" + "<div class='subregion_num'>" + color_status[5][0] + "</div>"
                addon_html += "</div>"

              addon_html += "</div>"
            addon_html += "</div>"
          }
        }
    }  
    shareTitle = "아파트랭크BIZ "
    shareTitle += "'" + $('#sido option:selected').text() + "' " + "부동산 시장 현황"

    shareText = "[" + $('#sido option:selected').text() + "]" +  "\n\n"
    shareText += shareTextSum
    
    shareURL = sURL
  }
  else{
    //$('#dataList').css("display", "block")

    shareTextSum = ""
    for(i = 0; i < listData.length; i++){
      var compare_link = listData[i]["Link"]
      if(compare_link == selectedSubRegion){
          var region_name = listData[i]["시군구"]

          var long_region_name = region_name.split(' ')
          if(selectedSubRegion == "4812500000_Gyeongsangnamdo_Changwon_Masanhappo" || selectedSubRegion == "4812700000_Gyeongsangnamdo_Changwon_Masanhoewon"){
            region_name = long_region_name[1] + " " + long_region_name[2]
          }
          
          var pop_info = listData[i]["인구정보"]
          var pop_rate = listData[i]["인구상승률"]
          var pop_score = listData[i]["인구점수"]
          var pop_nearby = listData[i]["인근지역통합정보"]

          var sales_info = listData[i]["매매가현황"]
          var sales_rate = listData[i]["매매상승률"]          
          var sales_score = listData[i]["매매점수"]

          var rent_info = listData[i]["전세가현황"]
          var rent_rate = listData[i]["전세상승률"] 

          var price_per_py = listData[i]["평단가"]

          var build_year = listData[i]["년차"]

          var non_sales = listData[i]["미분양현황"]

          var rent_ratio = listData[i]["전세가율"]
          var rent_score = listData[i]["전세점수"]

          var supply_volume = listData[i]["입주물량"]
          var supply_new_volume = listData[i]["분양물량"]
          var supply_proper = listData[i]["적정공급물량"]
          var supply_score = listData[i]["공급량점수"]

          var deal_info = listData[i]["거래량현황"]
          var deal_score = listData[i]["거래량점수"]

          var regulation_info = listData[i]["규제현황"]

          var total_score = listData[i]["총점"]
          var sURL = listData[i]["sURL"]

          //아파트랭크 연결 버튼
          var aptrank_link = "<div><img src = './icon_apt_rank.png' width='40px' height='40px'></div>"
            + "<div style='padding-left: 8px;'>" + region_name + "의 <br> 아파트 입지순위 보기</div>"
            + "<div style='text-align:center; font-size: 1.5em; line-height: 2em'><i class='fa-solid fa-circle-chevron-right'></i></div>"        
          $('#go_to_aptrank').html(aptrank_link)

          //총평가 표시 영역
          addon_html += "<div id='subRegion_line1'>"
            addon_html += "<div id='region_eval_table'>"
              addon_html += "<div style='border-right: 1px solid #aaa'>"
                addon_html += "<div style='color:" + set_color(total_score[0][0]) +"; font-size: 2rem; line-height:1.3em'>●</div>"
                addon_html += "<div style='line-height: 1em; font-weight: 600'>" + total_score[0][1] + "</div>"
                addon_html += "<div style='font-size: 0.8em; font-weight: 600'>(" + total_score[0][0].toFixed(2) + "점)</div>"
              addon_html += "</div>"

              pop_total = Number(pop_info[0][0]).toLocaleString() + "명"
              pop_rate_3y = Number(pop_rate[4]).toFixed(2)
              if (pop_rate_3y < 0){ pop_rate_comment = (pop_rate_3y * -1) + "% 감소"}
              if (pop_rate_3y >= 0){ pop_rate_comment = (pop_rate_3y) + "% 증가"}

              eval_summary = "<li>" + region_name + "의 총인구 <u>" + pop_total + "</u> (3년전 대비 <u>'" + pop_rate_comment + "'</u>)"
              eval_summary += "<li>" + "매매가는 최근 3개월전 가격 대비 <span style='color:" + set_text_color(sales_score[2][2]) + "'>'" + sales_score[2][2] + "세'</span>"

              shareTextSum += "ㆍ" + "총인구 " + pop_total + " (3년전 대비 '" + pop_rate_comment + "')" + "\n"
              shareTextSum += "ㆍ" + "매매가 최근 3개월전 가격 대비 '" + sales_score[2][2] + "세'" + "\n"

              deal_10y_avg = Number(deal_info[0]).toFixed(0)
              deal_current = Number(deal_info[1])
              deal_rate = ((deal_info[1]/deal_info[0])*100).toFixed(2) + "%"

              eval_summary += "<li>" + "거래량은 <u>총 " + deal_current + "건</u>, 10년 평균 대비 <u>" + deal_rate + "</u>로 <span style='color:" + set_text_color(deal_score[0][1]) + "'>'" + deal_score[0][1] + "'</span>"
              shareTextSum += "ㆍ" + "거래량 총 " + deal_current + "건, 10년 평균 대비 " + deal_rate + "로 '" + deal_score[0][1] + "'\n"

              supply_proper_formatted = Number(supply_proper).toLocaleString()
              supply_volume_year = Number(supply_volume[0]+supply_new_volume[0]).toLocaleString()
              supply_volume_plus_minus = supply_proper - (supply_volume[0]+supply_new_volume[0])
              if(supply_volume_plus_minus < 0){
                supply_volume_plus_minus = "'<u>" + (supply_volume_plus_minus * -1).toLocaleString() + "세대 과다'</u>로"                
              }
              else{
                supply_volume_plus_minus = "'<u>" + supply_volume_plus_minus.toLocaleString() + "세대 부족'</u>으로"                
              }

              supply_volume_plus_minus_txt = supply_volume_plus_minus.replace("<u>", "")
              supply_volume_plus_minus_txt = supply_volume_plus_minus_txt.replace("</u>", "")
              
              eval_summary += "<li>" + "공급물량은 당해 기준, <u>총 " + supply_volume_year + "세대</u>가 입주 예정"
              shareTextSum += "ㆍ" + "공급물량 당해 기준, 총 " + supply_volume_year + "세대 입주 예정" + "\n"

              eval_summary += "<li>" + "적정공급량 대비 " + supply_volume_plus_minus + " 예상되어 <span style='color:" + set_text_color(supply_score[1]) + "'>'" + supply_score[1] + "'</span>"
              shareTextSum += "ㆍ" + "적정공급량 대비 " + supply_volume_plus_minus_txt + " 예상되어 '" + supply_score[1] + "'\n"

              eval_summary += "<li>" + "종합적 결과, <u>" + region_name + "</u>는 현재 진입하기에 <span style='color:" + set_text_color(total_score[0][1]) + "'>'" + total_score[0][1] + "'</span>"
              shareTextSum += "ㆍ" + "종합적 결과, " + region_name + "는 현재 진입하기에 '" + total_score[0][1] + "'" + "\n"

              addon_html += "<div id='region_summary'>" + eval_summary + "</div>"
            addon_html +="</div>"
          addon_html += "</div>"

          //평단가, 주택노후, 규제현황 표시 영역
          addon_html += "<div id='subRegion_line2'>"

            //평단가 표시
            addon_html += "<div class='subRegion_info'>"
              addon_html += "<div class='subRegion_name'>평단가<span style='font-size: 0.8em'> (단위: 만원)</span></div>"
              addon_html += "<div class = 'subRegion_py_price_table'>"
                addon_html += "<div class='table_top'><strong>평균</strong></div>" + "<div class='table_top'>10평형</div>"
                              + "<div class='table_top'>20평형</div>" + "<div class='table_top'>30평형</div>" + "<div class='table_top'>40평형</div>" + "<div class='table_top'>50평형↑</div>"

                py_price_avg = Math.round(Number(price_per_py[0]),0).toLocaleString()
                py_price_10 = price_per_py[1]
                py_price_20 = price_per_py[2]
                py_price_30 = price_per_py[3]
                py_price_40 = price_per_py[4]
                py_price_50 = price_per_py[5]
                if(py_price_10 == '거래 없음'){ py_price_10 = "--" }
                else{ py_price_10 = '@' + Math.round(Number(price_per_py[1]),0).toLocaleString()}
                if(py_price_20 == '거래 없음'){ py_price_20 = "--" }
                else{ py_price_20 = '@' + Math.round(Number(price_per_py[2]),0).toLocaleString()}
                if(py_price_30 == '거래 없음'){ py_price_30 = "--" }
                else{ py_price_30 = '@' + Math.round(Number(price_per_py[3]),0).toLocaleString()}
                if(py_price_40 == '거래 없음'){ py_price_40 = "--" }
                else{ py_price_40 = '@' + Math.round(Number(price_per_py[4]),0).toLocaleString()}
                if(py_price_50 == '거래 없음'){ py_price_50 = "--" }
                else{ py_price_50 = '@' + Math.round(Number(price_per_py[5]),0).toLocaleString()}                

                addon_html += "<div><strong>@" + py_price_avg + "</strong></div>" + "<div>" + py_price_10 +"</div>" + "<div>" + py_price_20 + "</div>"
                              + "<div>" + py_price_30 + "</div>" + "<div>" + py_price_40 + "</div>" + "<div>" + py_price_50 + "</div>"
              addon_html += "</div>"
            addon_html += "</div>"
            
            //주택노후 표시
            addon_html += "<div class='subRegion_info'>"
              addon_html += "<div class='subRegion_name'>주택노후<span style='font-size: 0.8em'> (단위: 세대)</span></div>"
              addon_html += "<div class = 'subRegion_year_table'>"
                addon_html += "<div class='table_top'><strong>평균연차</strong></div>" + "<div class='table_top'>0-5년</div>"
                              + "<div class='table_top'>6-10년</div>" + "<div class='table_top'>11-15년</div>" + "<div class='table_top'>16-20년</div>"
                              + "<div class='table_top'>20-25년</div>" + "<div class='table_top'>26-30년</div>"+ "<div class='table_top'>31년↑</div>"

                build_year_avg = Math.round(build_year[0], 0)+"년"
                build_year_00_05 = Math.round(Number(build_year[1]),0).toLocaleString()
                build_year_06_10 = Math.round(Number(build_year[2]),0).toLocaleString()
                build_year_11_15 = Math.round(Number(build_year[3]),0).toLocaleString()
                build_year_16_20 = Math.round(Number(build_year[4]),0).toLocaleString()
                build_year_21_25 = Math.round(Number(build_year[5]),0).toLocaleString()
                build_year_26_30 = Math.round(Number(build_year[6]),0).toLocaleString()
                build_year_31 = Math.round(Number(build_year[7]),0).toLocaleString()

                addon_html += "<div><strong>" + build_year_avg +"</strong></div>" + "<div>" + build_year_00_05 +"</div>" + "<div>" + build_year_06_10 + "</div>"
                              + "<div>" + build_year_11_15 +"</div>" + "<div>" + build_year_16_20 + "</div>" + "<div>" + build_year_21_25 + "</div>"
                              + "<div>" + build_year_26_30 + "</div>" + "<div>" + build_year_31 + "</div>"
              addon_html += "</div>"
            addon_html += "</div>"

            //규제현황 표시
            addon_html += "<div class='subRegion_info'>"              
              addon_html += "<div class='subRegion_title'>"
                addon_html += "<div class='subRegion_name'>규제현황</div>"
                addon_html += "<div class='subRegion_qna' data-bs-toggle='modal' data-bs-target='#exampleModal' id='myModal' onClick='showNotice(\"regulation\")'><i class='fa-solid fa-circle-question'></i></div>"
              addon_html += "</div>"

              addon_html += "<div class = 'subRegion_regu_table'>"
                regu_0 = regulation_info[0]
                regu_1 = regulation_info[1]
                regu_2 = regulation_info[2]
                regu_3 = regulation_info[3]

                if(regu_0 == '적용'){ regu_text_0 = "<span style='color:#B80F0A; font-weight:600'> 투기과열 </span>" } else{ regu_text_0 = "투기과열" }
                if(regu_1 == '적용'){ regu_text_1 = "<span style='color:#B80F0A; font-weight:600'> 조정대상 </span>" } else{ regu_text_1 = "조정대상" }
                if(regu_2 == '적용'){ regu_text_2 = "<span style='color:#000000; '> 분양가상한제 </span>" } else{ regu_text_2 = "분양가상한제" }
                if(regu_3 == '적용'){ regu_text_3 = "<span style='color:#000000; '> 고분양가심사 </span>" } else{ regu_text_3 = "고분양가심사" }

                addon_html += "<div class='table_top'>" + regu_text_0 + "</div>" + "<div class='table_top'>" + regu_text_1 + "</div>"
                              + "<div class='table_top'>" + regu_text_2 + "</div>" + "<div class='table_top'>" + regu_text_3 + "</div>"                

                if(regu_0 == '적용'){ regu_0 = "<span style='color:#B80F0A'> ● </span>" } else{ regu_0 = "X" }
                if(regu_1 == '적용'){ regu_1 = "<span style='color:#B80F0A'> ● </span>" } else{ regu_1 = "X" }
                if(regu_2 == '적용'){ regu_2 = "<span style='color:#000000'> O </span>" } else{ regu_2 = "X" }
                if(regu_3 == '적용'){ regu_3 = "<span style='color:#000000'> O </span>" } else{ regu_3 = "X" }

                addon_html += "<div>" + regu_0 + "</div>" + "<div>" + regu_1 + "</div>" + "<div>" + regu_2 + "</div>" + "<div>" + regu_3 + "</div>"
              addon_html += "</div>"
            addon_html += "</div>"
          addon_html += "</div>"

          addon_html += "<div id='subRegion_line3'>"
            //인구
            addon_html += "<div class='subRegion_info'>"
              addon_html += "<div class='subRegion_title'>"
                addon_html += "<div class='subRegion_name'>" + "<span style='color:" + set_color(pop_score[0][0]) +"'>●</span>" + " 인구<span style='font-size: 0.8em'> (" + pop_score[0][0].toFixed(2) + "점 / " + pop_score[0][1] + ")</span></div>"
                addon_html += "<div class='subRegion_qna' data-bs-toggle='modal' data-bs-target='#exampleModal' id='myModal' onClick='showNotice(\"pop\")'><i class='fa-solid fa-circle-question'></i></div>"
              addon_html += "</div>"

              addon_html += "<div class = 'subRegion_pop_table1'>"
                addon_html += "<div class='table_top'>총인구</div>" + "<div class='table_top'>세대수</div>" + "<div class='table_top'>세대당 인구</div>"

                pop_total = Number(pop_info[0][0]).toLocaleString() + "명"
                pop_house_num = Number(pop_info[0][1]).toLocaleString() + "세대"
                pop_house_per = Number(pop_info[0][2]).toLocaleString() + "명"

                addon_html += "<div><strong>" + pop_total + "</div>" + "<div>" + pop_house_num + "</div>" + "<div>" + pop_house_per + "</strong></div>"
              addon_html += "</div>"

              addon_html += "<div class='graph'> <canvas id='popChart'></canvas></div>"
              
              addon_html += "<div class = 'subRegion_pop_table2'>"
                addon_html += "<div class='table_top'>5년</div>" + "<div class='table_top'>3년</div>" + "<div class='table_top'>1년</div>"
                              +"<div class='table_top'>6개월</div>" + "<div class='table_top'>3개월</div>" + "<div class='table_top'>1개월</div>"

                pop_rate_1m = Number(pop_rate[0]).toFixed(2)
                pop_rate_3m = Number(pop_rate[1]).toFixed(2)
                pop_rate_6m = Number(pop_rate[2]).toFixed(2)
                pop_rate_1y = Number(pop_rate[3]).toFixed(2)
                pop_rate_3y = Number(pop_rate[4]).toFixed(2)
                pop_rate_5y = Number(pop_rate[5]).toFixed(2)
                var pop_rate_text = ["(<전)", "5년", "3년", "1년", "6개월", "3개월", "1개월", "현재", "(후>)"]
                var pop_rate_array = [null, pop_info[6][0], pop_info[5][0], pop_info[4][0], pop_info[3][0], pop_info[2][0], pop_info[1][0], pop_info[0][0], null]
                var house_rate_array = [null, pop_info[6][1], pop_info[5][1], pop_info[4][1], pop_info[3][1], pop_info[2][1], pop_info[1][1], pop_info[0][1], null]

                if(pop_rate_1m < 0){ pop_rate_1m = "<span style='color:blue'>▼" + (pop_rate_1m)*-1 + "% </span>" } else{ pop_rate_1m = "<span style='color:#fe4040'>▲" + (pop_rate_1m) + "% </span>" }
                if(pop_rate_3m < 0){ pop_rate_3m = "<span style='color:blue'>▼" + (pop_rate_3m)*-1 + "% </span>" } else{ pop_rate_3m = "<span style='color:#fe4040'>▲" + (pop_rate_3m) + "% </span>" }
                if(pop_rate_6m < 0){ pop_rate_6m = "<span style='color:blue'>▼" + (pop_rate_6m)*-1 + "% </span>" } else{ pop_rate_6m = "<span style='color:#fe4040'>▲" + (pop_rate_6m) + "% </span>" }
                if(pop_rate_1y < 0){ pop_rate_1y = "<span style='color:blue'>▼" + (pop_rate_1y)*-1 + "% </span>" } else{ pop_rate_1y = "<span style='color:#fe4040'>▲" + (pop_rate_1y) + "% </span>" }
                if(pop_rate_3y < 0){ pop_rate_3y = "<span style='color:blue'>▼" + (pop_rate_3y)*-1 + "% </span>" } else{ pop_rate_3y = "<span style='color:#fe4040'>▲" + (pop_rate_3y) + "% </span>" }
                if(pop_rate_5y < 0){ pop_rate_5y = "<span style='color:blue'>▼" + (pop_rate_5y)*-1 + "% </span>" } else{ pop_rate_5y = "<span style='color:#fe4040'>▲" + (pop_rate_5y) + "% </span>" }                

                addon_html += "<div>" + pop_rate_5y + "</div>" + "<div>" + pop_rate_3y + "</div>" + "<div>" + pop_rate_1y + "</div>"
                              + "<div>" + pop_rate_6m+ "</div>" + "<div>" + pop_rate_3m + "</div>" + "<div>" + pop_rate_1m + "</div>"
              addon_html += "</div>" 
            addon_html += "</div>"

            //매매가격
            addon_html += "<div class='subRegion_info'>"              

              addon_html += "<div class='subRegion_title'>"
                addon_html += "<div class='subRegion_name'>" + "<span style='color:" + set_color(sales_score[1][0]) +"'>●</span>" + " 매매가격<span style='font-size: 0.8em'> (" + sales_score[1][0].toFixed(2) + "점 / " + sales_score[1][1] + ")</span></div>"
                addon_html += "<div class='subRegion_qna' data-bs-toggle='modal' data-bs-target='#exampleModal' id='myModal' onClick='showNotice(\"price\")'><i class='fa-solid fa-circle-question'></i></div>"
              addon_html += "</div>"
              
              addon_html += "<div class = 'subRegion_price_table1'>"
                addon_html += "<div class='table_top'>매매가 평균</div>" + "<div class='table_top'>3개월 매매흐름</div>"
                sales_price = (sales_info[0]/100000).toFixed(2) + "억원"
                addon_html += "<div><strong>" + sales_price + "</div>" + "<div>" + sales_score[1][2] + "</strong></div>"
              addon_html += "</div>"

              addon_html += "<div class='graph'> <canvas id='salesChart'></canvas></div>"

              addon_html += "<div class = 'subRegion_price_table2'>"
                addon_html += "<div class='table_top'>5년</div>" + "<div class='table_top'>3년</div>"
                              + "<div class='table_top'>1년</div>" + "<div class='table_top'>6개월</div>" + "<div class='table_top'>3개월</div>"  + "<div class='table_top'>1개월</div>"

                sales_rate_1m = Number(sales_rate[1]).toFixed(2)
                sales_rate_3m = Number(sales_rate[2]).toFixed(2)
                sales_rate_6m = Number(sales_rate[3]).toFixed(2)
                sales_rate_1y = Number(sales_rate[4]).toFixed(2)
                sales_rate_3y = Number(sales_rate[5]).toFixed(2)
                sales_rate_5y = Number(sales_rate[6]).toFixed(2)

                sales_this = (Number(sales_info[0])/100000).toFixed(3)
                sales_1m = (Number(sales_info[1])/100000).toFixed(3)
                sales_3m = (Number(sales_info[2])/100000).toFixed(3)
                sales_6m = (Number(sales_info[3])/100000).toFixed(3)
                sales_1y = (Number(sales_info[4])/100000).toFixed(3)
                sales_3y = (Number(sales_info[5])/100000).toFixed(3)
                sales_5y = (Number(sales_info[6])/100000).toFixed(3)

                var sales_rate_text = ["(<전)", "5년", "3년", "1년", "6개월", "3개월", "1개월", "당월", "(후>)"]
                var sales_price_array = [null, sales_5y, sales_3y, sales_1y, sales_6m, sales_3m, sales_1m, sales_this, null]

                rent_this = (Number(rent_info[0])/100000).toFixed(3)
                rent_1m = (Number(rent_info[1])/100000).toFixed(3)
                rent_3m = (Number(rent_info[2])/100000).toFixed(3)
                rent_6m = (Number(rent_info[3])/100000).toFixed(3)
                rent_1y = (Number(rent_info[4])/100000).toFixed(3)
                rent_3y = (Number(rent_info[5])/100000).toFixed(3)
                rent_5y = (Number(rent_info[6])/100000).toFixed(3)
                var rent_price_array = [null, rent_5y, rent_3y, rent_1y, rent_6m, rent_3m, rent_1m, rent_this, null]                

                if(sales_rate_1m < 0){ sales_rate_1m = "<span style='color:blue'>▼" + (sales_rate_1m)*-1 + "% </span>" } else{ sales_rate_1m = "<span style='color:#fe4040'>▲" + (sales_rate_1m) + "% </span>" }                
                if(sales_rate_3m < 0){ sales_rate_3m = "<span style='color:blue'>▼" + (sales_rate_3m)*-1 + "% </span>" } else{ sales_rate_3m = "<span style='color:#fe4040'>▲" + (sales_rate_3m) + "% </span>" }
                if(sales_rate_6m < 0){ sales_rate_6m = "<span style='color:blue'>▼" + (sales_rate_6m)*-1 + "% </span>" } else{ sales_rate_6m = "<span style='color:#fe4040'>▲" + (sales_rate_6m) + "% </span>" }
                if(sales_rate_1y < 0){ sales_rate_1y = "<span style='color:blue'>▼" + (sales_rate_1y)*-1 + "% </span>" } else{ sales_rate_1y = "<span style='color:#fe4040'>▲" + (sales_rate_1y) + "% </span>" }
                if(sales_rate_3y < 0){ sales_rate_3y = "<span style='color:blue'>▼" + (sales_rate_3y)*-1 + "% </span>" } else{ sales_rate_3y = "<span style='color:#fe4040'>▲" + (sales_rate_3y) + "% </span>" }
                if(sales_rate_5y < 0){ sales_rate_5y = "<span style='color:blue'>▼" + (sales_rate_5y)*-1 + "% </span>" } else{ sales_rate_5y = "<span style='color:#fe4040'>▲" + (sales_rate_5y) + "% </span>" }

                addon_html += "<div>" + sales_rate_5y + "</div>" + "<div>" + sales_rate_3y + "</div>"
                              + "<div>" + sales_rate_1y + "</div>" + "<div>" + sales_rate_6m + "</div>" + "<div>" + sales_rate_3m + "</div>" + "<div>" + sales_rate_1m + "</div>"
              addon_html += "</div>"

            addon_html += "</div>"

            addon_html += "<div class='subRegion_info'>"             

              addon_html += "<div class='subRegion_title'>"
                addon_html += "<div class='subRegion_name'>" + "<span style='color:" + set_color(deal_score[0][0]) +"'>●</span>" + " 거래량<span style='font-size: 0.8em'> (" + deal_score[0][0].toFixed(2) + "점 / " + deal_score[0][1] + ")</span></div>"
                addon_html += "<div class='subRegion_qna' data-bs-toggle='modal' data-bs-target='#exampleModal' id='myModal' onClick='showNotice(\"deal\")'><i class='fa-solid fa-circle-question'></i></div>"
              addon_html += "</div>"
          
                addon_html += "<div class = 'subRegion_deal_table1'>"
                addon_html += "<div class='table_top'>10년 평균</div>" + "<div class='table_top'>당월</div>" + "<div class='table_top'>평균대비</div>"
                
                deal_10y_avg = Number(deal_info[0]).toFixed(0) + "건"
                deal_current = Number(deal_info[1]) + "건"
                deal_rate = ((deal_info[1]/deal_info[0])*100).toFixed(2) + "%"

                addon_html += "<div><strong>" + deal_10y_avg + "</div>" + "<div>" + deal_current + "</div>" + "<div>" + deal_rate + "</strong></div>"
              addon_html += "</div>"

              addon_html += "<div class='graph'> <canvas id='dealChart'></canvas></div>"

              addon_html += "<div class = 'subRegion_deal_table2'>"
                addon_html += "<div class='table_top'>5년 전</div>" + "<div class='table_top'>3년 전</div>" + "<div class='table_top'>1년 전</div>"
                                + "<div class='table_top'>6개월 전</div>" + "<div class='table_top'>3개월 전</div>" + "<div class='table_top'>1개월 전</div>"                
                
                deal_1m = Number(deal_info[2]).toFixed(0) + "건"
                deal_3m = Number(deal_info[3]).toFixed(0) + "건"
                deal_6m = Number(deal_info[4]).toFixed(0) + "건"
                deal_1y = Number(deal_info[5]).toFixed(0) + "건"
                deal_3y = Number(deal_info[6]).toFixed(0) + "건"
                deal_5y = Number(deal_info[7]).toFixed(0) + "건"

                var deal_text = ["(<전)", "5년", "3년", "1년", "6개월", "3개월", "1개월", "당월", "(후>)"]
                var deal_array = [null, Number(deal_info[7]).toFixed(0), Number(deal_info[6]).toFixed(0), Number(deal_info[5]).toFixed(0),
                                    Number(deal_info[4]).toFixed(0), Number(deal_info[3]).toFixed(0), Number(deal_info[2]).toFixed(0), Number(deal_info[1]).toFixed(1), null]
                var deal_10y = [deal_info[0], deal_info[0], deal_info[0], deal_info[0], deal_info[0], deal_info[0], deal_info[0], deal_info[0], deal_info[0]]

                addon_html += "<div>" + deal_5y + "</div>" + "<div>" + deal_3y + "</div>" + "<div>" + deal_1y + "</div>"
                              + "<div>" + deal_6m + "</div>" + "<div>" + deal_3m + "</div>" + "<div>" + deal_1m + "</div>"
              addon_html += "</div>"
            addon_html += "</div>"

            addon_html += "<div class='subRegion_info'>"              

              addon_html += "<div class='subRegion_title'>"
                addon_html += "<div class='subRegion_name'>" + "<span style='color:" + set_color(rent_score[0][0]) +"'>●</span>" + " 전세가율<span style='font-size: 0.8em'> (" + rent_score[0][0].toFixed(2) + "점 / " + rent_score[0][1] + ")</span></div>"
                addon_html += "<div class='subRegion_qna' data-bs-toggle='modal' data-bs-target='#exampleModal' id='myModal' onClick='showNotice(\"rent\")'><i class='fa-solid fa-circle-question'></i></div>"
              addon_html += "</div>"

              addon_html += "<div class = 'subRegion_rent_table1'>"
                addon_html += "<div class='table_top'>10년 평균</div>" + "<div class='table_top'>당월</div>"
                
                rent_rate_10y_avg = Number(rent_ratio[0]).toFixed(1) + "%"
                rant_rate_current = Number(rent_ratio[1]) + "%"

                addon_html += "<div><strong>" + rent_rate_10y_avg + "</div>" + "<div>" + rant_rate_current + "</strong></div>"
              addon_html += "</div>"

              addon_html += "<div class='graph'> <canvas id='rentChart'></canvas></div>"

              addon_html += "<div class = 'subRegion_rent_table2'>"
                addon_html += "<div class='table_top'>5년 전</div>" + "<div class='table_top'>3년 전</div>" + "<div class='table_top'>1년 전</div>"
                                + "<div class='table_top'>6개월 전</div>" + "<div class='table_top'>3개월 전</div>" + "<div class='table_top'>1개월 전</div>"
                
                rent_rate_1m = Number(rent_ratio[2]).toFixed(1) + "%"
                rent_rate_3m = Number(rent_ratio[3]).toFixed(1) + "%"
                rent_rate_6m = Number(rent_ratio[4]).toFixed(1) + "%"
                rent_rate_1y = Number(rent_ratio[5]).toFixed(1) + "%"
                rent_rate_3y = Number(rent_ratio[6]).toFixed(1) + "%"
                rent_rate_5y = Number(rent_ratio[7]).toFixed(1) + "%"

                var rent_rate_text = ["(<전)", "5년", "3년", "1년", "6개월", "3개월", "1개월", "당월", "(후>)"]
                var rent_rate_array = [null, Number(rent_ratio[7]).toFixed(1), Number(rent_ratio[6]).toFixed(1), Number(rent_ratio[5]).toFixed(1), Number(rent_ratio[4]).toFixed(1),
                                      Number(rent_ratio[3]).toFixed(1), Number(rent_ratio[2]).toFixed(1), Number(rent_ratio[1]).toFixed(1), null]
                var rent_rate_10y = [Number(rent_ratio[0]).toFixed(1), Number(rent_ratio[0]).toFixed(1), Number(rent_ratio[0]).toFixed(1), Number(rent_ratio[0]).toFixed(1), Number(rent_ratio[0]).toFixed(1)
                                    , Number(rent_ratio[0]).toFixed(1), Number(rent_ratio[0]).toFixed(1), Number(rent_ratio[0]).toFixed(1), Number(rent_ratio[0]).toFixed(1) ]

                addon_html += "<div>" + rent_rate_5y + "</div>" + "<div>" + rent_rate_3y + "</div>" + "<div>" + rent_rate_1y + "</div>"
                              + "<div>" + rent_rate_6m + "</div>" + "<div>" + rent_rate_3m + "</div>" + "<div>" + rent_rate_1m + "</div>"
              addon_html += "</div>"
              
            addon_html += "</div>"

            //공급물량
            addon_html += "<div class='subRegion_info'>"              

              addon_html += "<div class='subRegion_title'>"
                addon_html += "<div class='subRegion_name'>" + "<span style='color:" + set_color(supply_score[0]) +"'>●</span>" + " 공급물량<span style='font-size: 0.8em'> (" + supply_score[0].toFixed(2) + "점 / " + supply_score[1] + ")</span></div>"
                addon_html += "<div class='subRegion_qna' data-bs-toggle='modal' data-bs-target='#exampleModal' id='myModal' onClick='showNotice(\"supply\")'><i class='fa-solid fa-circle-question'></i></div>"
              addon_html += "</div>"

              addon_html += "<div class = 'subRegion_supply_table1'>"
                addon_html += "<div class='table_top'>적정 공급량 <span style='font-size: 0.6em'>(인구x0.5%)</span></div>" + "<div class='table_top'>당해 공급량</div>"+ "<div class='table_top'>적정 공급량 대비</div>"
                
                supply_proper_formatted = Number(supply_proper).toLocaleString() + "세대"
                supply_volume_this_year = Number(supply_volume[0]+supply_new_volume[0]).toLocaleString() + "세대"
                supply_volume_plus_minus = supply_proper - (supply_volume[0]+supply_new_volume[0])
                if(supply_volume_plus_minus < 0){
                  supply_volume_plus_minus = (supply_volume_plus_minus * -1).toLocaleString() + "세대 과다"
                }
                else{
                  supply_volume_plus_minus = supply_volume_plus_minus.toLocaleString() + "세대 부족"
                }

                addon_html += "<div><strong>" + supply_proper_formatted + "</div>" + "<div>" + supply_volume_this_year + "</div>" + "<div>" + supply_volume_plus_minus + "</strong></div>"
              addon_html += "</div>"

              addon_html += "<div class='graph'> <canvas id='supplyChart'></canvas></div>"

              addon_html += "<div class = 'subRegion_supply_table2'>"
                addon_html += "<div class='table_top'>1년 후</div>" + "<div class='table_top'>2년 후</div>" + "<div class='table_top'>3년 후</div>"// + "<div class='table_top'>4년 후</div>"
                
                supply_1y = Number(supply_volume[1] + supply_new_volume[1]).toLocaleString() + "세대"
                supply_2y = Number(supply_volume[2] + supply_new_volume[2]).toLocaleString() + "세대"
                supply_3y = Number(supply_volume[3] + supply_new_volume[3]).toLocaleString() + "세대"
                //supply_4y = Number(supply_volume[4] + supply_new_volume[4]).toLocaleString() + "세대"

                var supply_text = ["", "2023년", "2024년", "2025년", "2026년", ""]
                var supply_array = [null, supply_volume[0], supply_volume[1], supply_volume[2], supply_volume[3], null]
                var supply_new_array = [null, supply_new_volume[0], supply_new_volume[1], supply_new_volume[2], supply_new_volume[3], null]
                var supply_10y = [supply_proper, supply_proper, supply_proper, supply_proper, supply_proper, supply_proper]

                addon_html += "<div>" + supply_1y + "</div>" + "<div>" + supply_2y + "</div>" + "<div>" + supply_3y + "</div>" //+ "<div>" + supply_4y + "</div>"
              addon_html += "</div>"
            addon_html += "</div>"

            //미분양
            addon_html += "<div class='subRegion_info'>"              

              if(non_sales[0] == '6개월 미분양위험'){ non_sales_score = 0; non_sales_status = non_sales[0] }
              else if(non_sales[0] == '5개월 미분양위험'){ non_sales_score = 15; non_sales_status = non_sales[0] }
              else if(non_sales[0] == '4개월 미분양위험'){ non_sales_score = 30; non_sales_status = non_sales[0] }
              else if(non_sales[0] == '3개월 미분양위험'){ non_sales_score = 30; non_sales_status = non_sales[0] }
              else if(non_sales[0] == '미분양 급증'){ non_sales_score = 15; non_sales_status = non_sales[0] }
              else {non_sales_score = 100; non_sales_status = "위험 없음"}

              find_name = selectedSubRegion.split("_")
              var non_sales_add_text = ""
              if(find_name[2] == "Goyang"){ non_sales_add_text = " (고양시 전체)" }
              if(find_name[2] == "Seongnam"){ non_sales_add_text = " (성남시 전체)" }
              if(find_name[2] == "Suwon"){ non_sales_add_text = " (수원시 전체)" }
              if(find_name[2] == "Ansan"){ non_sales_add_text = " (안산시 전체)" }
              if(find_name[2] == "Anyang"){ non_sales_add_text = " (안양시 전체)" }
              if(find_name[2] == "Yongin"){ non_sales_add_text = " (용인시 전체)" }
              if(find_name[2] == "Cheongju"){ non_sales_add_text = " (청주시 전체)" }
              if(find_name[2] == "Cheonan"){ non_sales_add_text = " (천안시 전체)" }
              if(find_name[2] == "Jeonju"){ non_sales_add_text = " (전주시 전체)" }
              if(find_name[2] == "Pohang"){ non_sales_add_text = " (포항시 전체)" }
              if(find_name[2] == "Changwon"){ non_sales_add_text = " (창원시 전체)" }              

              addon_html += "<div class='subRegion_title'>"
                addon_html += "<div class='subRegion_name'>" + "<span style='color:" + set_color(non_sales_score) +"'>●</span>" + " 미분양" + non_sales_add_text + "<span style='font-size: 0.8em'> (" + non_sales_score.toFixed(2) + "점)</span></div>"
                addon_html += "<div class='subRegion_qna' data-bs-toggle='modal' data-bs-target='#exampleModal' id='myModal' onClick='showNotice(\"non_sales\")'><i class='fa-solid fa-circle-question'></i></div>"
              addon_html += "</div>"
          
                addon_html += "<div class = 'subRegion_non_sales_table1'>"
                addon_html += "<div class='table_top'>당월 미분양</div>" + "<div class='table_top'>위험수준</div>"
                
                non_sales_this = Number(non_sales[1]).toFixed(0) + "세대"

                addon_html += "<div><strong>" + non_sales_this + "</div>" + "<div>" + non_sales_status + "</strong></div>"
              addon_html += "</div>"

              addon_html += "<div class='graph'> <canvas id='nonSalesChart'></canvas></div>"

              addon_html += "<div class = 'subRegion_non_sales_table2'>"
                addon_html += "<div class='table_top'>5개월 전</div>" + "<div class='table_top'>4개월 전</div>" + "<div class='table_top'>3개월 전</div>"
                                + "<div class='table_top'>2개월 전</div>" + "<div class='table_top'>1개월 전</div>"
                
                non_sales_1m = Number(non_sales[2]).toFixed(0) + "세대"
                non_sales_2m = Number(non_sales[3]).toFixed(0) + "세대"
                non_sales_3m = Number(non_sales[4]).toFixed(0) + "세대"
                non_sales_4m = Number(non_sales[5]).toFixed(0) + "세대"
                non_sales_5m = Number(non_sales[6]).toFixed(0) + "세대"

                var non_sales_text = ["(<전)", "5개월", "4개월", "3개월",  "2개월", "1개월", "당월", "(후>)"]
                var non_sales_array = [null, Number(non_sales[6]).toFixed(0), Number(non_sales[5]).toFixed(0), Number(non_sales[4]).toFixed(0), Number(non_sales[3]).toFixed(0)
                                       , Number(non_sales[2]).toFixed(0), Number(non_sales[1]).toFixed(0), null]

                addon_html += "<div>" + non_sales_5m + "</div>" + "<div>" + non_sales_4m + "</div>" + "<div>" + non_sales_3m + "</div>"
                              + "<div>" + non_sales_2m + "</div>" + "<div>" + non_sales_1m + "</div>"
              addon_html += "</div>"
            addon_html += "</div>"

          //아파트랭크
          addon_html += "<div class='subRegion_rank'>"
            addon_html += "<div class='subRegion_title'>"
              addon_html += "<div class='subRegion_name'>아파트 입지 평가 TOP 7</div>"
              addon_html += "<div class='subRegion_qna' data-bs-toggle='modal' data-bs-target='#exampleModal' id='myModal' onClick='showNotice(\"aptrank_list\")'><i class='fa-solid fa-circle-question'></i></div>"
            addon_html += "</div>"
            addon_html += "<div class='aptRankList' style='background: #ddd; height: 24px'>"
              addon_html += "<div>단지</div>"
              addon_html += "<div>주거</div>"
              addon_html += "<div>교통</div>"
              addon_html += "<div>인프라</div>"
              addon_html += "<div>교육</div>"
              addon_html += "<div>총점</div>"              
            addon_html += "</div>"
            addon_html += "<div id='arank0'></div>"
            addon_html += "<div id='arank1'></div>"
            addon_html += "<div id='arank2'></div>"
            addon_html += "<div id='arank3'></div>"
            addon_html += "<div id='arank4'></div>"
            addon_html += "<div id='arank5'></div>"
            addon_html += "<div id='arank6'></div>"            
          addon_html += "</div>"

          rank_url = "https://www.aptrank.kr/202304/" + selectedSubRegion + ".json"
          
          $.ajax({
            url: rank_url,
            type: 'HEAD',
            success: function(){
              $.getJSON(rank_url, function(json) {
                rankData = json
                rankDetail = rankData.data
                for( var p = 0 ; p < 7; p++){
                  aptName = rankDetail[p]['아파트명']          
                  aptAddress = rankDetail[p]['법정동주소']
                  aptLivingScore = rankDetail[p]['주거총점']
                  aptTransScore = rankDetail[p]['교통총점']
                  aptInfraScore = rankDetail[p]['인프라총점']
                  aptEduScore = rankDetail[p]['학군총점']
                  aptValueScore = rankDetail[p]['가치 총점']
                  aptURL = rankDetail[p]['sURL']                          
                  arankID = "#arank" + p

                  rankHTML = "<div class='aptRankList' onClick='window.open(\"" + aptURL + "\")'>"
                    rankHTML += "<div id='aptName'>" + aptName + "</div>"
                    rankHTML += "<div>" + aptLivingScore.toFixed(1) + "</div>"
                    if(aptTransScore != "NA"){
                      rankHTML += "<div>" + aptTransScore.toFixed(1) + "</div>"
                    }
                    else{
                      rankHTML += "<div>--</div>"
                    }                    
                    rankHTML += "<div>" + aptInfraScore.toFixed(1) + "</div>"
                    rankHTML += "<div>" + aptEduScore.toFixed(1) + "</div>"
                    rankHTML += "<div style='font-weight: 600'>" + aptValueScore.toFixed(1) + "</div>"
                  rankHTML += "</div>"

                  $(arankID).html(rankHTML)
                }        

                $('.subRegion_rank').show()
              })
            },          
            error: function(){
              console.log("No file")
              $('.subRegion_rank').hide()
            }
          })

          //매매, 전세가격지수
          var regName = $('#sido option:selected').text() + " " + $('#gungu option:selected').text()
          regName = regName.replace(" 전체", "")

          if(rateExist.includes(regName)){
              addon_html += "<div class='subRegion_info2' style='grid-column: 2 / span 2;'>"
                addon_html += "<div class='subRegion_title'>"
                  addon_html += "<div class='subRegion_name'>KB부동산 매매/전세 지수</div>"
                  addon_html += "<div class='subRegion_qna' data-bs-toggle='modal' data-bs-target='#exampleModal' id='myModal' onClick='showNotice(\"sales_rent_index\")'><i class='fa-solid fa-circle-question'></i></div>"
                addon_html += "</div>"
                addon_html += "<div class='graph' style='height: 250px;'> <canvas id='priceRateChart'></canvas></div>"
              addon_html += "</div>"

              var dateArray = ["", ""]
              var salesArray = [null, null]
              var rentArray = [null, null]

              rate_url = "https://www.aptrank.kr/202304/Price_Rate/" + regName + ".json"

              $.getJSON(rate_url, function(json) {                
                rateData = json
                for (var i = (rateData.data).length-60 ; i < (rateData.data).length ; i++){
                  pushed_date = "'"+(rateData.data[i]["Date"]).toString().substr(2, 2) + "." + (rateData.data[i]["Date"]).toString().substr(4, 2)
                  dateArray.push(pushed_date)
                  salesArray.push(rateData.data[i]["Sales"])
                  rentArray.push(rateData.data[i]["Rent"])
                }

                dateArray.push("")
                dateArray.push("")
                salesArray.push(null)
                salesArray.push(null)
                rentArray.push(null)
                rentArray.push(null)

                drawPriceRateChart(dateArray, salesArray, rentArray)
              })
              $('.subRegion_info2').show()
            }
            else{
              $('.subRegion_info2').hide()
            }

          addon_html += "</div></div>"
      }
    }
  }

  shareTitle = "아파트랭크BIZ "
  shareTitle += "'" + $('#sido option:selected').text() + " " + $('#gungu option:selected').text() + "' " + "부동산 시장 현황"

  shareText = "[" + $('#sido option:selected').text() + " " + $('#gungu option:selected').text() + "]" +  "\n\n"
  shareText += shareTextSum
  
  shareURL = sURL

  $('#dataList').append(addon_html);
  if(selectedRegion != 'Korea'){
    popMax = Math.max(...pop_rate_array) * 1.05
    drawPopChart(pop_rate_text, pop_rate_array, house_rate_array, "popChart", popMax)

    salesMax = Math.max(...sales_price_array) * 1.1
    drawSalesChart(sales_rate_text, sales_price_array, rent_price_array, "salesChart", salesMax)

    dealMax = Math.max(...deal_array) * 1.1
    drawDealChart(deal_text, deal_array, "dealChart", dealMax, deal_10y)
    
    drawRentChart(rent_rate_text, rent_rate_array, "rentChart", rent_rate_10y)

    supplyMax = ( Math.max(...supply_array) + Math.max(...supply_new_array) ) * 1.1
    drawSupplyChart(supply_text, supply_array, supply_new_array, "supplyChart", supply_10y, supplyMax)   
    drawNonSalesChart(non_sales_text, non_sales_array, "nonSalesChart")
  }
  saveLocalStorage()
}

function showNotice(info){
  modal_title = ""
  modal_info= ""

  if(info == "pop"){
    modal_title = biz_title_pop
    modal_info = biz_info_pop
  }
  if(info == "price"){
    modal_title = biz_title_price
    modal_info = biz_info_price
  }
  if(info == "deal"){
    modal_title = biz_title_deal
    modal_info = biz_info_deal
  }
  if(info == "rent"){
    modal_title = biz_title_rent_rate
    modal_info = biz_info_rent_rate
  }
  if(info == "supply"){
    modal_title = biz_title_supply
    modal_info = biz_info_supply
  }
  if(info == "non_sales"){
    modal_title = biz_title_non_sales
    modal_info = biz_info_non_sales
  }
  if(info == "regulation"){
    modal_title = biz_title_regulation
    modal_info = biz_info_regulation
  }
  if(info == "aptrank_list"){
    modal_title = biz_title_aptrank_list
    modal_info = biz_info_aptrank_list
  } 
  if(info == "sales_rent_index"){
    modal_title = biz_title_sales_rent_index
    modal_info = biz_info_sales_rent_index
  }  

    var titleHtml = "<div class='popupTitle'>" + modal_title + "</div>";
    var footerHtml = ""
    var detailHtml = "<div class='notice'>" + modal_info + "</div>"
    
    footerHtml += "<div class='modal-footer'>"
    footerHtml += "<div class='notice' id='footerCheck' ><strong>업무 협업, 데이터 커스터마이징 문의는 '이메일 문의하기' 또는 '카카오톡 1:1 문의하기'를 통해 진행해 주세요.</strong></div>"
    footerHtml += "<div id='footerBtn2'><a href='mailto:aptranking@gmail.com'><button type='button' class='goApt' style='font-size: 0.85em'>이메일 문의하기</button></a></div>"
    footerHtml += "<div id='footerBtn2'><a href='https://pf.kakao.com/_vESNb/chat' target='_blank'><button type='button' class='gokakao' style='font-size: 0.85em'>카카오톡 1:1 문의하기</button></a></div>"
    footerHtml += "</div>"  


    $('#exampleModalLabel').html(titleHtml);
    $('#aptDetail').html(detailHtml);
    $('#footer').html(footerHtml);
    $('#footerCheck').css({"grid-column" : "span 2"})
    $('.modal-footer').css({"padding-top" : "3px"})
  }

  var pcDevice = "win16|win32|win64|mac|macintel"

  function openAptrank(){
    to_subRegion = selectedSubRegion

    if(selectedSubRegion == "4128000000_Gyeonggi_Goyang"){ to_subRegion = "4128700000_Gyeonggi_Goyang_Ilsanseo"}
    if(selectedSubRegion == "4113000000_Gyeonggi_Seongnam"){ to_subRegion = "4113500000_Gyeonggi_Seongnam_Bundang" }
    if(selectedSubRegion == "4111000000_Gyeonggi_Suwon"){ to_subRegion = "4111700000_Gyeonggi_Suwon_Yeongtong" }
    if(selectedSubRegion == "4127000000_Gyeonggi_Ansan"){ to_subRegion = "4127100000_Gyeonggi_Ansan_Sangnok" }
    if(selectedSubRegion == "4117000000_Gyeonggi_Anyang"){ to_subRegion = "4117300000_Gyeonggi_Anyang_Dongan" }
    if(selectedSubRegion == "4146000000_Gyeonggi_Yongin"){ to_subRegion = "4146500000_Gyeonggi_Yongin_Suji" }

    if(selectedSubRegion == "Seoul"){ to_subRegion = "1168000000_Seoul_Gangnam"}
    if(selectedSubRegion == "Busan"){ to_subRegion = "2650000000_Busan_Suyeong" }
    if(selectedSubRegion == "Daegu"){ to_subRegion = "2726000000_Daegu_Suseong" }
    if(selectedSubRegion == "Incheon"){ to_subRegion = "2818500000_Incheon_Yeonsu" }
    if(selectedSubRegion == "Gwangju"){ to_subRegion = "2915500000_Gwangju_Nam" }
    if(selectedSubRegion == "Daejeon"){ to_subRegion = "3020000000_Daejeon_Yuseong" }
    if(selectedSubRegion == "Ulsan"){ to_subRegion = "3114000000_Ulsan_Nam" }

    aURL = "https://www.aptrank.kr" + "?reg=" + selectedRegion +"&sub=" + to_subRegion
    if ( navigator.platform ) {
        if ( pcDevice.indexOf(navigator.platform.toLowerCase()) < 0 ) {
          location.href = aURL
        } else {
          window.open(aURL)
        }
    }    
  }
</script>
</html>
