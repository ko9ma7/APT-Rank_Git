<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-KNL2VQN');</script>
  <!-- End Google Tag Manager -->

  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-218993952-1">
  </script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-218993952-1');

    if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('serviceWorker_biz.js')
      .then((reg) => {
        console.log('Service Worker Registered!', reg);
      });
    }
  </script>

  <title>분양가 GENERATOR</title>
  <meta property="og:type" content="website">
  <meta property="og:title" content="분양가 Generator">
  <meta property="og:description" content="알고리즘 기반 분양가 GENERATOR">
  <meta property="og:image" content="https://www.aptrank.kr/priceCal/thumbnail_priceCal.png">
  <meta property="og:url" content="https://www.aptrank.kr/priceCal/">
  <meta name="keyword" content="부동산, 아파트, 입지, 순위, 아파트입지, 우리동네, 호가, 대장아파트, 최고가, 신고가, 호재, AI, 등수">
  <meta name="description" content="알고리즘 기반 분양가 GENERATOR">
  <meta name="author" content="분양가 GENERATOR">
  <meta name="robots" content="index,follow">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=yes, minimal-ui, viewport-fit=cover">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- 주소창 등의 웹 브라우저 UI를 표시하지 않기 -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <!-- 상태 바의 스타일을 지정 -->
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- 홈 화면에서 표시되는 앱 이름을 지정 -->
  <meta name="apple-mobile-web-app-title" content="분양가 GENERATOR">
  <!-- 홈 화면에서 표시되는 앱 아이콘을 지정 -->
  <link rel="apple-touch-icon" href="https://www.aptrank.kr/biz/apt-rank-biz-152x152.png">
  <!-- 웹 앱 매니페스트를 읽어 들이기 -->
  <link rel="manifest" href="manifest_biz.json">  

  <link rel="canonical" href="https://www.aptrank.kr/biz/">
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link rel="shortcut icon" href="https://www.aptrank.kr/biz/apt-rank-biz.png"/>


  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"  crossorigin="anonymous"></script>
  <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>


  <script src="../../js/menu_select_box.js" type="text/javascript"></script>
  <script src="../../js/draw_chart_BIZ.js" type="text/javascript"></script>
  <script src="../../js/sort.js" type="text/javascript"></script>
  <script src="../../js/search.js" type="text/javascript"></script>  
  <script src="../../js/share.js" type="text/javascript"></script>
  <script src="../../js/distance.js" type="text/javascript"></script>
  <script src="../../js/svg_region.js" type="text/javascript"></script>
  <script src="../../js/BIZ_guide.js" type="text/javascript"></script>  

  <link href="./style_priceCal.css" rel="stylesheet"/>
  <link href="../css/slider.css" rel="stylesheet"/>
  <link href="../css/distance.css" rel="stylesheet"/>

  <script src="../js/doubleSlider.js" type="text/javascript"></script>

  <script type="text/javascript">
    var UserAgent = navigator.userAgent; 
    if (UserAgent.match(/iPhone|ipad|Android|Windows CE|BlackBerry|Symbian|Windows Phone|webOS|Opera Mini|Opera Mobi|POLARIS|IEMobile|lgtelecom|nokia|SonyEricsson/i) != null || UserAgent.match(/LG|SAMSUNG|Samsung/) != null)
    {
      location.href = "./m/index.html"; /* 모바일 홈페이지 경로 */
    }
  </script>  
</head>
<style>
</style>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNL2VQN"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <!-- 타이틀 영역 -->
  <div id="titleBar_theme">
    <!--검색 버튼 표시-->
    <!-- <div id='help' style='font-size: 1.2em' onClick='share(shareTitle, shareText, shareURL)'><i class='fa-solid fa-arrow-up-right-from-square'></i></button></div> -->
    <!-- <div id="rearrange" class="position-relative" onClick='showRearrangeBar(this)'><i class="fa-solid fa-arrow-down-wide-short"></i></div> -->
    <div></div>
    <!--타이틀 표시-->
    <!-- <div id="title" onClick='window.location.reload()'>아파트랭크<span id="themeLogo">BIZ</span> X 파트너를 찾습니다!</div> -->
    <div id="title" onClick='window.location.reload()'>분양가 GENERATOR <span id="themeLogo">BETA</span></div>
    <div id="footer_text"></div>
    <!--공유 버튼-->        
    <!-- <div id='tripGuide' data-bs-toggle='modal' data-bs-target='#toggleModal1' id='myModal' onClick='showDistance(routeArray)'><i class="fa-solid fa-route"></i></div> -->
    
    <!--단지 가중치 설정 버튼 표시-->        
    <!-- <div id='help' data-bs-toggle='modal' data-bs-target='#exampleModal' id='myModal' onClick='showNotice()'><i class="fa-solid fa-circle-question"></i></div> -->
    <div></div>
  </div>

  <div id="container">
    <div></div>
    <div id="centerBox">
      <!-- Vertically centered scrollable modal -->
        <!-- Button trigger modal -->
        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body" id='aptDetail'></div>
              <div id='footer'></div>
            </div>
          </div>
        </div>     

      <!--리스트 데이터 붙여넣는 영역-->
      <div id='contentBox'>
        <div id="themeSelections">        
          <div id="sido_selection"><select id="sido" onChange="sidoChange()" ></select></div>
          <div id="gungu_selection" style="width: 330px"><select id="gungu" onChange="updateRegion()"></select></div>          
          <div id="update_info"></div>
          <div></div>
          <div></div>          
        </div>

        <div id = "step1">
          <div class='stepInfo'>① 시장 환경 설정</div>

          <div id="step1Content">
            <div>
              <div class="step1Title">기준시점</div>
              <div><select id='baseDate' onChange='setStartDate(this.value)' size='5'></select></div>
            </div>

            <div id="housingSelection">
              <div class="step1Title">주택가격상승률 (~2022.06)</div>
                <div id="wrapper" style="padding-left: 30px">
                  <label class='radioOptions'>
                    <div><input type="radio" class="housingPrice" name="housing_options" id="housing_option3" autocomplete="off" value = "Housing_KO" onchange="set_housing_ratio()"> Korea</div>
                    <div id='Housing_KO' class='housing_value' for="housing_option3"></div>
                  </label>
                  <label class='radioOptions'>                  
                    <div><input type="radio" class="housingPrice" name="housing_options" id="housing_option1" autocomplete="off" value = "Housing_OECD" onchange="set_housing_ratio()"> OECD</div>
                    <div id='Housing_OECD' class='housing_value' for="housing_option1"></div>
                  </label>
                  <label class='radioOptions'>
                    <div><input type="radio" class="housingPrice" name="housing_options" id="housing_option2" autocomplete="off" value = "Housing_US" onchange="set_housing_ratio()"> US</div>
                    <div id='Housing_US' class='housing_value' for="housing_option2"></div>
                  </label>                  
                  <label class='radioOptions'>
                    <div><input type="radio" class="housingPrice" name="housing_options" id="housing_option4" autocomplete="off" value = "Housing_CUSTOM" onchange="set_housing_ratio()" checked> 직접설정</div>
                    <div id='Housing_CUSTOM' class='housing_value' for="housing_option4"><input type='number' id='housing_custom' min='-80' max='80' value="0.00" step="0.05" onchange="set_custom_housing_ratio()" onkeyup="set_custom_housing_ratio()">%</div>
                  </label>
                </div>
            </div>

            <div id="CPISelection">
              <div class="step1Title">현재 인플레이션률</div>
                <div id="wrapper" style="padding-left: 30px">
                  <label class='radioOptions'>
                    <div><input type="radio" class="CPI" name="CPI_options" id="CPI_option3" autocomplete="off" value = "CPI_KO" onchange="set_CPI_ratio()"> Korea</div>
                    <div id='CPI_KO' class='CPI_value' for="CPI_option3"></div>
                  </label>
                  <label class='radioOptions'>                  
                    <div><input type="radio" class="CPI" name="CPI_options" id="CPI_option1" autocomplete="off" value = "CPI_OECD" onchange="set_CPI_ratio()"> OECD</div>
                    <div id='CPI_OECD' class='CPI_value' for="CPI_option1"></div>
                  </label>
                  <label class='radioOptions'>
                    <div><input type="radio" class="CPI" name="CPI_options" id="CPI_option2" autocomplete="off" value = "CPI_US" onchange="set_CPI_ratio()"> US</div>
                    <div id='CPI_US' class='CPI_value' for="CPI_option2"></div>
                  </label>                  
                  <label class='radioOptions'>
                    <div><input type="radio" class="CPI" name="CPI_options" id="CPI_option4" autocomplete="off" value = "CPI_CUSTOM" onchange="set_CPI_ratio()" checked> 직접설정</div>
                    <div id='CPI_CUSTOM' class='CPI_value' for="CPI_option4"><input type='number' id='CPI_custom' min='-15' max='15' value="0.00" step="0.05" onchange="set_custom_CPI_ratio()" onkeyup="set_custom_CPI_ratio()">%</div>
                  </label>
                </div>
            </div>

            <div>
              <div id="wrapper" style="text-align: center;">
                <div class="step1Title">임의가중치</div>
                <div id="addtional"><input type='number' id='addon_KO' min='-15' max='15' value="0.00" step="0.05" onchange="set_addon_ratio()" onkeyup="set_addon_ratio()">%</div>
              </div>
            </div>

            <div>
              <div class="step1Title">상승률 결과</div>
              <div id='rate_result'>
                <div id='rate_result_guide'></div>
                <div id='rate_result_value' style='font-size: 2em; font-weight: 600; color: #a20c0c'></div>
              </div>
            </div>
          </div>
        </div>

        <div id="step2">
          <div class='stepInfo'>② 건물 감가 설정</div>
          <div><input type='number' id='house_depreciation' min='0' max='10' value="0.00" step="0.05" onchange="set_depreciation_ratio()" onkeyup="set_depreciation_ratio()">%</div>
        </div>

        <div id="step3">
          <div class='stepInfo'>③ 비교 단지 설정</div>
          <div id="step3Content"></div>
        </div>

        <div id="step4">
          <div class='stepInfo'>④ 추천 평단가</div>
          <div id="step4Content">
            <div class='py_result'>
              <div class="step4Title">추천 평단가</div>
              <div id="py_val"></div>              
            </div>
            <div class='py_result'>
              <div class="step4Title">16평</div>
              <div id="py10_val"></div>              
            </div>
            <div class='py_result'>
              <div class="step4Title">24평</div>
              <div id="py20_val"></div>              
            </div>
            <div class='py_result'>
              <div class="step4Title">34평</div>
              <div id="py30_val"></div>              
            </div>
            <div class='py_result'>
              <div class="step4Title">45평</div>
              <div id="py40_val"></div>              
            </div>
            <div class='py_result'>
              <div class="step4Title">55평</div>
              <div id="py50_val"></div>              
            </div>
            <div class='py_result'>
              <div class="step4Title">65평</div>
              <div id="py60_val"></div>              
            </div>            
          </div>
        </div>

      </div>
    </div>
    
    <div></div>
  </div>

  <!--
  <div id="footer_area">
    <div></div>
    <div id="footer_text">Copyright 2022 | 아파트랭크BIZ | <a href="mailto:aptranking@gmail.com" style="text-decoration:None; color: white">aptranking@gmail.com  </a></div>
    <div></div>
  </div>
  -->
  <div id="footer_area">
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.0/dist/chart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

</body>

<script>
  var selectedRegion = "Seoul"
  var selectedSubRegion = "1168000000_Seoul_Gangnam"
  var selectedTheme = "under100M"  

  var regionName = ""

  var linked = ""
  var regionValue = ""

  var itemNum = 0;
  var aptData = "";
  var sortData = "";

  var housingRatio = 0
  var CPIRatio = 0
  var addonRatio = 0
  var finalRatio = 0
  var houseDepreciation = 0

  var today = new Date()
  var today_year = today.getFullYear();
  var today_month = dateReturn( (today.getMonth() + 1))
  var today_day = dateReturn( today.getDate() );
  var today_num = Number(today_year + today_month + today_day)

  var todayMonthQuater = ""
 
  todayQuaterCheck = today.getMonth() + 1
  if(todayQuaterCheck >= 1 && todayQuaterCheck <= 3){
    todayMonthQuater = "1Q"
  }
  else if(todayQuaterCheck >= 4 && todayQuaterCheck <= 6){
    todayMonthQuater = "2Q"
  }
  else if(todayQuaterCheck >= 7 && todayQuaterCheck <= 9){
    todayMonthQuater = "3Q"
  }
  else{
    todayMonthQuater = "4Q"
  }
  var todayQuater = today_year.toString() + "-" + todayMonthQuater

  var startYear = "2019"
  var startMonth = "06"
  var startQuater = "2Q"

  var CPI_KO = ""
  var CPI_US = ""
  var CPI_OECD = ""

  var Housing_KO = ""
  var Housing_US = ""
  var Housing_OECD = ""

  var CPIF_KO = ""
  var CPIF_US = ""
  var CPIF_OECD = ""

  var priceResult = []

  function dateReturn(n){
    return n<10 ? "0"+n : n
  }  

  var broswerInfo = navigator.userAgent;  

  $(document).ready(function(){

    Kakao.init(kakaoKey);

    var option = ""
    for(i = 1 ; i < regions.length ; i++){
        option += "<option value='" + regions[i][1] + "'>" + regions[i][0] + "</option>"
    }
    $('#sido').html(option)    

    var lastRegion = localStorage.getItem('lastRegion')
    var lastSubRegion = localStorage.getItem('lastSubRegion')
    var lastTheme = localStorage.getItem('lastTheme')
    var lastNoticed = localStorage.getItem('lastNoticed')        

    var lastRegion = sessionStorage.getItem('lastRegion')
    var lastSubRegion = sessionStorage.getItem('lastSubRegion')
    var lastMonth = sessionStorage.getItem('lastMonth')

    const url = new URL(window.location.href)
    const urlParams = url.searchParams
    console.log(urlParams)

    if(urlParams.has('reg')){
      console.log(urlParams.get('reg'))
      selectedRegion = urlParams.get('reg')
    }
    else if(lastRegion != null){
      selectedRegion = lastRegion
    }

    if(urlParams.has('sub')){
      console.log(urlParams.get('sub'))
      selectedSubRegion = urlParams.get('sub')
    }
    else if(lastSubRegion != null){
      selectedSubRegion = lastSubRegion
    }

    $("#sido").val(selectedRegion).prop("selected", true);
    regionName = $("#sido option:selected").val();

    $('#themeDataList').html("");

    optionChange(selectedSubRegion)
    updateRegion()

    loadForecastBase()

    $('div.modal').on('show.bs.modal', function() {
      var modal = this;
      var hash = modal.id;
      window.location.hash = hash;
      window.onhashchange = function() {
        if (!location.hash){
          $(modal).modal('hide');
        }
      }
    });

    add_compare()
    /*
    if(broswerInfo.indexOf("inApp")>-1){
      shareHtml = "<div class='bShare' onClick='kakaoShare(shareTitle, shareText, shareURL)'><img src=\"kakao_icon.png\" height=\"30px\"/>&nbsp공유하기</div>"
    }
    else{      
      shareHtml = "<div class='bShare' onClick='share(shareTitle, shareText, shareURL)'><button type='button' class='goApt' style='font-size: 0.95em; height: 46px'><i class='fa-solid fa-up-right-from-square'></i> 공유하기</button></div>"      
    }
    $('#bizShare').html(shareHtml)    
    */
  });

  function loadForecastBase(){
    url = "https://www.aptrank.kr/biz/Forecast_Base.json"
    $.getJSON(url, function(json) {
        forecastBase = json;

        CPI_KO = forecastBase.data[0]
        CPI_US = forecastBase.data[1]
        CPI_OECD = forecastBase.data[2]

        Housing_KO = forecastBase.data[3]
        Housing_US = forecastBase.data[4]
        Housing_OECD = forecastBase.data[5]

        CPIF_KO = forecastBase.data[6]
        CPIF_US = forecastBase.data[7]
        CPIF_OECD = forecastBase.data[8]

        $('#CPI_KO').html(getLatestCPI('CPI_KO') + "%")
        $('#CPI_US').html(getLatestCPI('CPI_US') + "%")
        $('#CPI_OECD').html(getLatestCPI('CPI_OECD') + "%")
        //$('#CPI_CUSTOM').html(getLatestCPI('CPI_CUSTOM'))
        //CPIRatio = Number(getLatestCPI('CPI_KO'))
        CPIRatio = 0

        $('#Housing_KO').html(getLatestHousingPriceRate('Housing_KO') + "%")
        $('#Housing_US').html(getLatestHousingPriceRate('Housing_US') + "%")
        $('#Housing_OECD').html(getLatestHousingPriceRate('Housing_OECD') + "%")
        //$('#Housing_CUSTOM').html(getLatestCPI('CPI_KO'))
        //housingRatio = Number(getLatestHousingPriceRate('Housing_KO'))
        housingRatio = 0

        set_final_ratio()
    })
  }

  function setStartDate(val){  
    startYear = val.substr(0, 4)
    startMonth = val.substr(4, 2)  
    quaterCheck = Number(startMonth)
    if(quaterCheck >= 1 && quaterCheck <= 3){
      startQuater = "1Q"
    }
    else if(quaterCheck >= 4 && quaterCheck <= 6){
      startQuater = "2Q"
    }
    else if(quaterCheck >= 7 && quaterCheck <= 9){
      startQuater = "3Q"
    }
    else{
      startQuater = "4Q"
    }

    $('#Housing_KO').html(getLatestHousingPriceRate('Housing_KO') + "%")
    $('#Housing_US').html(getLatestHousingPriceRate('Housing_US') + "%")
    $('#Housing_OECD').html(getLatestHousingPriceRate('Housing_OECD') + "%")

    set_housing_ratio()
  }

  function add_compare(){
    for (var i = 0 ; i < 6 ; i++){
      adding_tag = "<div class='subRegion_info'>"
                + "<div class='subRegion_title'>"
                //+ "<div class='subRegion_name'>비교단지 " + (i+1) + "</div>"
                + "</div>"
        
                + "<div class = 'subRegion_pop_table1'>"
                + "<div><select class='aptListSelect' id='aptListSelect" + i + "' onChange='updateComplex(this.value, " + i + ")'></select></div>"
                + "<div><select class='aptListSelect' id='aptpy" + i + "' onChange='updatePyeong(this.value, " + i + ")'></select></div>"
                + "</div>"
                + "<div class = 'compares'>"
                + "<div class = 'compare_comment'>"
                + "<div id='compare" + i + "_comment1'>--</div>"
                + "<div id='compare" + i + "_result1'>--</div>"
                + "</div>"
                + "<div class = 'compare_comment'>"
                + "<div id='compare" + i + "_comment2'>--</div>"
                + "<div id='compare" + i + "_result2'>--</div>"
                + "</div>"
                + "<div class = 'compare_comment'>"
                + "<div id='compare" + i + "_comment3'>--</div>"
                + "<div id='compare" + i + "_result3'>--</div>"
                + "</div>"
                + "<div class = 'compare_comment'>"
                + "<div id='compare" + i + "_comment4'>--</div>"
                + "<div id='compare" + i + "_result4'>--</div>"
                + "</div>"
                + "</div>"
                //+ "</div>"

      $('#step3Content').append(adding_tag)
    }
  }

  function set_housing_ratio(){
    housing_ratio_val = $("input[name=housing_options]:checked").val();    
    if(housing_ratio_val == "Housing_CUSTOM"){
      housingRatio = Number($('#housing_custom').val())
    }
    else{
      housing_ratio_txt = $("#" + housing_ratio_val).text();
      housingRatio = Number(housing_ratio_txt.replace("%", ""))      
    }
    set_final_ratio()
  }

  function set_custom_housing_ratio(){
    $(":radio[name='housing_options'][value='Housing_CUSTOM']").prop('checked', true);
    housingRatio = Number($('#housing_custom').val())    
    set_final_ratio()
  }

  function set_CPI_ratio(){
    CPI_ratio_val = $("input[name=CPI_options]:checked").val();    
    if(CPI_ratio_val == "CPI_CUSTOM"){
      CPIRatio = Number($('#CPI_custom').val())
    }
    else{
      CPI_ratio_txt = $("#" + CPI_ratio_val).text();
      CPIRatio = Number(CPI_ratio_txt.replace("%", ""))
    }
    set_final_ratio()
  }

  function set_custom_CPI_ratio(){
    $(":radio[name='CPI_options'][value='CPI_CUSTOM']").prop('checked', true);
    CPIRatio = Number($('#CPI_custom').val())
    set_final_ratio()
  }

  function set_addon_ratio(){
    addonRatio = Number($('#addon_KO').val())
    set_final_ratio()
  }

  function set_final_ratio(){
    guideTxt = ""
    guideTxt += "주택가격상승률 " + housingRatio.toFixed(2) + "%<br>"
    guideTxt += " + 인플레이션률 " + CPIRatio.toFixed(2) + "%<br>"
    guideTxt += " + 임의가중치 " + addonRatio.toFixed(2) + "%<br>"

    finalRatio = (housingRatio + CPIRatio + addonRatio).toFixed(2)
    finalRatioTxt = ""
    if(finalRatio > 0){
      finalRatioTxt = "+" + finalRatio.toString()
    }
    else if(finalRatio == 0){
      finalRatioTxt = finalRatio.toString()
    }
    else{
      finalRatioTxt = "-" + finalRatio.toString()
    }
    $('#rate_result_guide').html(guideTxt)
    $('#rate_result_value').html(finalRatioTxt + "%")

    for(var i = 0 ; i < 6 ; i++){
      updatePrice(i)
    }
  }

  function set_depreciation_ratio(){
    houseDepreciation = Number($('#house_depreciation').val())
    for(var i = 0 ; i < 6 ; i++){
      updatePrice(i)
    }
  }

  function sidoChange(){
    optionChange()
    updateRegion()
  }

  function saveLocalStorage(){
    localStorage.setItem('lastRegion', selectedRegion)
    localStorage.setItem('lastSubRegion', selectedSubRegion)
    localStorage.setItem('lastTheme', selectedTheme)
  }

  function scrollUp(){
    $( 'html, body' ).animate( { scrollTop : 0 }, 50 );
  }

  function optionChange(subRegion){
    selectedSubRegion = subRegion
    regionName = $("#sido option:selected").val();
    selectedRegion = regionName
    var changeItem    
    if(regionName == 'Korea'){
      changeItem = inKorea      
    }
    if(regionName == 'Seoul'){
      changeItem = inSeoul
    }
    if(regionName == 'Busan'){
      changeItem = inBusan
    }
    if(regionName == 'Incheon'){
      changeItem = inIncheon
    }
    if(regionName == 'Daegu'){
      changeItem = inDaegu
    }
    if(regionName == 'Gwangju'){
      changeItem = inGwangju
    }
    if(regionName == 'Daejeon'){
      changeItem = inDaejeon
    }
    if(regionName == 'Ulsan'){
      changeItem = inUlsan
    }
    if(regionName == 'Sejong'){
      changeItem = inSejong
    }
    if(regionName == 'Gyeonggi'){
      changeItem = inGyeonggi
    }
    if(regionName == 'Gangwondo'){
      changeItem = inGangwondo
    }
    if(regionName == 'Chungcheongbukdo'){
      changeItem = inChungcheongbukdo
    }
    if(regionName == 'Chungcheongnamdo'){
      changeItem = inChungcheongnamdo
    }
    if(regionName == 'Jeollabukdo'){
      changeItem = inJeollabukdo
    }
    if(regionName == 'Jeollanamdo'){
      changeItem = inJeollanamdo
    }
    if(regionName == 'Gyeongsangbukdo'){
      changeItem = inGyeongsangbukdo
    }
    if(regionName == 'Gyeongsangnamdo'){
      changeItem = inGyeongsangnamdo
    }
    if(regionName == 'Jejudo'){
      changeItem = inJejudo
    }
    $('#gungu').empty();

    for(var i = 0 ; i < changeItem.length; i++){
      var subOption = $("<option value='" + changeItem[i][1] + "'>" + changeItem[i][0] + "</option>")
      $('#gungu').append(subOption);
    }    

    if(selectedSubRegion == undefined){
      $("#gungu").val(changeItem[0][1]).prop("selected", true);
      selectedSubRegion = $("#gungu option:selected").val()
    }
    else{
      $("#gungu").val(selectedSubRegion).prop("selected", true);      
    }
    updateRegion()    
  }  

  function updateRegion(){
    var selection = document.getElementById("gungu")
    selectedRegion = $("#sido option:selected").val()
    selectedSubRegion = $("#gungu option:selected").val()    
    updateTable()
    regionName = $("#sido option:selected").text()  
  }

  function updateTable(){
    $('div.modal').modal("hide");
    //$('#sort').css("visibility", "visible")
    $('html').scrollTop(0)    
    
    //url = "https://www.aptrank.kr/biz/" + region + ".json"
    //url = "https://www.aptrank.kr/biz/Location_Build_Valuated.json"
    url = "https://www.aptrank.kr/202302/" + selectedSubRegion + ".json"

    apturl = "https://www.aptrank.kr/202302/" + selectedSubRegion + ".json"
    $.getJSON(url, function(json) {
        //console.log(json);
        aptData = json;

        key = "아파트명"
        type = "asc"

        data = aptData.data
        var sortJSON = function(data, key, type) {
          if (type == undefined) {
            type = "desc";
          }
          return data.sort(function(a, b) {
            var x = a[key];
            var y = b[key];
            if (type == "desc") {
              return x > y ? -1 : x < y ? 1 : 0;
            } else if (type == "asc") {
              return x < y ? -1 : x > y ? 1 : 0;
            }
          });
        };
        sortData = sortJSON(data, key, type)
        ListUp(sortData)
  })}

function changeRegion(sido){
  find_length = sido.split("_")

  if( find_length.length > 1 ){
    selectedSubRegion = sido
    selectedRegion = (sido.split("_"))[1]    
    optionChange(selectedSubRegion)
  }
  else{
    selectedRegion = sido
    $('#sido').val(selectedRegion).prop("selected", true)
    optionChange()
  }  
}

function getLatestCPI(baseData){
  var checkObj = ''
  if(baseData == 'CPI_KO'){
    checkObj = CPI_KO
  }
  if(baseData == 'CPI_US'){
    checkObj = CPI_US
  }
  if(baseData == 'CPI_OECD'){
    checkObj = CPI_OECD
  }
  checkArray = Object.values(checkObj)  

  for(var j = checkArray.length-1 ; j > 0 ; j--){
    if(checkArray[j] != 'NA'){
      //console.log(checkArray[0][i])
      return checkArray[j].toFixed(2)
    }
  }
}

function getLatestHousingPriceRate(baseData){
  var checkObj = ''
  if(baseData == 'Housing_KO'){
    checkObj = Housing_KO
  }
  if(baseData == 'Housing_US'){
    checkObj = Housing_US
  }
  if(baseData == 'Housing_OECD'){
    checkObj = Housing_OECD
  }
  
  baseDateVal = checkObj[startYear + "-" + startQuater]
  checkArray = Object.values(checkObj)

  if(baseDateVal == "NA" || isNaN(baseDateVal)){
    housingRatio = 0
    return housingRatio.toFixed(2)
  }
  else{
    for(var j = checkArray.length-1 ; j > 0 ; j--){    
      if(checkArray[j] != 'NA'){      
        housingRatio = ((checkArray[j] / baseDateVal) - 1) * 100      
        return housingRatio.toFixed(2)
      }
    }
  }
}

function ListUp(listData){  
  $('html').scrollTop(0)    
  $('#dataList').html("");

  var aptListOption = "<option value='" + "-1" + "'>" + "비교단지를 선택하세요." + "</option>"
  for(var k = 0 ; k < listData.length ; k++){
    remove_addr = $("#sido option:selected").text()  + " " + $("#gungu option:selected").text()
    show_Addr = listData[k]['법정동주소'].replace(remove_addr, "")
    aptListOption += "<option value='" + k + "'>" + listData[k]['아파트명'] + " (" + listData[k]['세대수'] + "세대, "+ show_Addr + ")</option>"
  }
  var pyListOPtion = "<option value='" + "-1" + "'>" + "---" + "</option>"

  var baseDate = ""
    for(j = 1990 ; j < 2023 ; j++){
      for(k = 1 ; k <= 12 ; k++){
        if(k < 10){
          dateVal = j.toString() + "0" + k.toString()
          dateTxt = j.toString() + "-0" + k.toString()
        }
        else{
          dateVal = j.toString() + k.toString()
          dateTxt = j.toString() + "-" + k.toString()
        }        
        baseDate += "<option value='" + dateVal + "'>" + dateTxt + "</option>"
      }        
    }
    $("#baseDate").html(baseDate)
    $("#baseDate").val(startYear+startMonth).prop("selected", true);

    for (var i = 0 ; i < 6 ; i++){
      $("#aptListSelect" + i).html(aptListOption)
      $("#aptpy" + i).html(pyListOPtion)

      $('#compare' + i + "_comment1").html("--")
      $('#compare' + i + "_result1").html("--")
      $('#compare' + i + "_comment2").html("--")
      $('#compare' + i + "_result2").html("--")
      $('#compare' + i + "_comment3").html("--")
      $('#compare' + i + "_result3").html("--")
      $('#compare' + i + "_comment4").html("--")
      $('#compare' + i + "_result4").html("--")
    }

    selectedComplex = ""
    selectedComplex0 = ""
    selectedComplex1 = ""
    selectedComplex2 = ""
    selectedComplex3 = ""
    selectedComplex4 = ""
    selectedComplex5 = ""

    $('#py_val').html("--")
    $('#py10_val').html("--")
    $('#py20_val').html("--")
    $('#py30_val').html("--")
    $('#py40_val').html("--")
    $('#py50_val').html("--")
    $('#py60_val').html("--")

  saveLocalStorage()
}

var selectedComplex = ""
var selectedComplex0 = ""
var selectedComplex1 = ""
var selectedComplex2 = ""
var selectedComplex3 = ""
var selectedComplex4 = ""
var selectedComplex5 = ""

function updateComplex(val, compareid){
  console.log(compareid)
  if(val == -1){
    $("#aptpy" + compareid).html("<option value='0'>" + "--" + "</option>")
  }
  else{
    selectedComplex = sortData[Number(val)]
    window['selectedComplex'+compareid] = selectedComplex
    pyeong = selectedComplex['area_info']  
    pyeong_list = pyeong.split(",")
    pyeong_option = ""
    for(var i = 0 ; i < pyeong_list.length ; i++){
      py_val = pyeong_list[i].substr(0, 2)
      pyeong_option += "<option value='" + i + "'>" + pyeong_list[i] + "</option>"
    }
    $("#aptpy" + compareid).html(pyeong_option)
  }

  updatePrice(compareid)
}

function updatePyeong(val, compareid){
  updatePrice(compareid)
}

function updatePrice(compareid){
  selectedComplex = window['selectedComplex'+compareid]
  dateArray = selectedComplex["매매실거래날짜목록"]
  sales_history = selectedComplex["sales_history_price"]  
  buildYear = selectedComplex["준공년월"]
  buildYearNum = buildYear.substr(0, 4)
  years = Number(startYear) - Number(buildYearNum)

  py_val = $('#aptpy' + compareid + ' option:selected').val()
  optionNum = $('#aptpy' + compareid + ' option').length
  console.log(py_val)
  findDate = startYear + startMonth

  for(var i = 0 ; i <= dateArray.length ; i++){
    if(dateArray[i] == findDate){
      if(optionNum > 1){
        price = sales_history[py_val][i]
      }
      else{
        price = sales_history[i]
      }      
      break;
    }
    else{
      price = 0;
    }
  }
  complex = $("#aptListSelect" + compareid+ ' option:selected').text()
  if(complex.length > 9){
    complex = complex.substr(0, 9) + "..."
  }

  complex_val = $("#aptListSelect" + compareid+ ' option:selected').val()

  comment1 = "① '" + complex + "'의 " + startYear + "년 " + startMonth + "월 매매가"
  if(price == 0 || isNaN(price)){
    comment1_result = "거래없음"
  }
  else{
    comment1_result = (price/10000).toFixed(2) + "억"
  }
  if(complex_val == "-1"){
    $('#compare' + compareid + "_comment1").html("--")
    $('#compare' + compareid + "_result1").html("--")
  }
  else{
    $('#compare' + compareid + "_comment1").html(comment1)
    $('#compare' + compareid + "_result1").html(comment1_result)
  }

  if(comment1_result == "거래없음" || complex_val == "-1"){
    $('#compare' + compareid + "_comment2").html("--")
    $('#compare' + compareid + "_result2").html("--")
    $('#compare' + compareid + "_comment3").html("--")
    $('#compare' + compareid + "_result3").html("--")
    $('#compare' + compareid + "_comment4").html("--")
    $('#compare' + compareid + "_result4").html("--")
    priceResult[compareid] = 0
  }
  else{
    comment2 = "② '" + complex + "' 단지가 " + startYear + "년 신축이라면 <br>"
    //comment2 += "&nbsp&nbsp&nbsp&nbsp&nbsp( " + comment1_result + " x (1 + (" + years + "년 x 건물감가 " + (houseDepreciation).toFixed(2) + "%) )"
    
    resul2_price = price * (1 + (years * houseDepreciation/100))
    comment2_result = ( resul2_price / 10000 ).toFixed(2) + "억"

    $('#compare' + compareid + "_comment2").html(comment2)
    $('#compare' + compareid + "_result2").html(comment2_result)
    
    comment3 = "③ '" + complex + "' 단지에 상승률 결과를 반영하면, <br>"
    //comment3 += "&nbsp&nbsp&nbsp&nbsp&nbsp( " + comment2_result + " x (1 + 상승률 결과 " + finalRatio + "%) )"
    
    resul3_price = resul2_price * (1 + finalRatio/100)
    comment3_result = ( resul3_price / 10000 ).toFixed(2) + "억"

    $('#compare' + compareid + "_comment3").html(comment3)
    $('#compare' + compareid + "_result3").html(comment3_result)

    comment4 = "④ '" + complex + "' 단지를 비교한 적정 평단가는, <br>"
    py = $("#aptpy" + compareid+ ' option:selected').text()
    py = py.substr(0, py.indexOf('평'))
    py = Number(py)
    //comment4 += "&nbsp&nbsp&nbsp&nbsp&nbsp( " + comment3_result + " / " + py +"평)"
    resul4_price = Number( (resul3_price / py).toFixed(2) )
    comment4_result = ( resul4_price.toLocaleString() ) + "만원"
    console.log(comment4_result)

    $('#compare' + compareid + "_comment4").html(comment4)
    $('#compare' + compareid + "_result4").html(comment4_result)
    priceResult[compareid] = resul4_price
  }

  updateResult()
}

function updateResult(){
  count = 0
  sum = 0
  for(var i = 0 ; i < priceResult.length; i++){
    if(priceResult[i] != 0){
      count++
      sum += priceResult[i]
    }
  }
  pyPriceAvg = sum/count
  if(sum == 0){
    $('#py_val').html("--")
    $('#py10_val').html("--")
    $('#py20_val').html("--")
    $('#py30_val').html("--")
    $('#py40_val').html("--")
    $('#py50_val').html("--")
    $('#py60_val').html("--")
  }
  else{
    $('#py_val').html("@" + Number( pyPriceAvg.toFixed(2) ).toLocaleString())
    $('#py10_val').html( Number( Number(pyPriceAvg * 16 * 10000).toFixed(0) ).toLocaleString() )
    $('#py20_val').html( Number( Number(pyPriceAvg * 24 * 10000).toFixed(0) ).toLocaleString() )
    $('#py30_val').html( Number( Number(pyPriceAvg * 34 * 10000).toFixed(0) ).toLocaleString() )
    $('#py40_val').html( Number( Number(pyPriceAvg * 45 * 10000).toFixed(0) ).toLocaleString() )
    $('#py50_val').html( Number( Number(pyPriceAvg * 55 * 10000).toFixed(0) ).toLocaleString() )
    $('#py60_val').html( Number( Number(pyPriceAvg * 65 * 10000).toFixed(0) ).toLocaleString() )
  }
}

function showNotice(info){
  modal_title = ""
  modal_info= ""

  if(info == "pop"){
    modal_title = biz_title_pop
    modal_info = biz_info_pop
  }
  if(info == "price"){
    modal_title = biz_title_price
    modal_info = biz_info_price
  }
  if(info == "deal"){
    modal_title = biz_title_deal
    modal_info = biz_info_deal
  }
  if(info == "rent"){
    modal_title = biz_title_rent_rate
    modal_info = biz_info_rent_rate
  }
  if(info == "supply"){
    modal_title = biz_title_supply
    modal_info = biz_info_supply
  }
  if(info == "non_sales"){
    modal_title = biz_title_non_sales
    modal_info = biz_info_non_sales
  }
  if(info == "regulation"){
    modal_title = biz_title_regulation
    modal_info = biz_info_regulation
  }
  if(info == "aptrank_list"){
    modal_title = biz_title_aptrank_list
    modal_info = biz_info_aptrank_list
  } 
  if(info == "sales_rent_index"){
    modal_title = biz_title_sales_rent_index
    modal_info = biz_info_sales_rent_index
  }  

    var titleHtml = "<div class='popupTitle'>" + modal_title + "</div>";
    var footerHtml = ""
    var detailHtml = "<div class='notice'>" + modal_info + "</div>"
    
    footerHtml += "<div class='modal-footer'>"
    footerHtml += "<div class='notice' id='footerCheck' ><strong>업무 협업, 데이터 커스터마이징 문의는 '이메일 문의하기' 또는 '카카오톡 1:1 문의하기'를 통해 진행해 주세요.</strong></div>"
    footerHtml += "<div id='footerBtn2'><a href='mailto:aptranking@gmail.com'><button type='button' class='goApt' style='font-size: 0.85em'>이메일 문의하기</button></a></div>"
    footerHtml += "<div id='footerBtn2'><a href='https://pf.kakao.com/_vESNb/chat' target='_blank'><button type='button' class='gokakao' style='font-size: 0.85em'>카카오톡 1:1 문의하기</button></a></div>"
    footerHtml += "</div>"  


    $('#exampleModalLabel').html(titleHtml);
    $('#aptDetail').html(detailHtml);
    $('#footer').html(footerHtml);
    $('#footerCheck').css({"grid-column" : "span 2"})
    $('.modal-footer').css({"padding-top" : "3px"})
  }

  var pcDevice = "win16|win32|win64|mac|macintel"

  function openAptrank(){
    to_subRegion = selectedSubRegion

    if(selectedSubRegion == "4128000000_Gyeonggi_Goyang"){ to_subRegion = "4128700000_Gyeonggi_Goyang_Ilsanseo"}
    if(selectedSubRegion == "4113000000_Gyeonggi_Seongnam"){ to_subRegion = "4113500000_Gyeonggi_Seongnam_Bundang" }
    if(selectedSubRegion == "4111000000_Gyeonggi_Suwon"){ to_subRegion = "4111700000_Gyeonggi_Suwon_Yeongtong" }
    if(selectedSubRegion == "4127000000_Gyeonggi_Ansan"){ to_subRegion = "4127100000_Gyeonggi_Ansan_Sangnok" }
    if(selectedSubRegion == "4117000000_Gyeonggi_Anyang"){ to_subRegion = "4117300000_Gyeonggi_Anyang_Dongan" }
    if(selectedSubRegion == "4146000000_Gyeonggi_Yongin"){ to_subRegion = "4146500000_Gyeonggi_Yongin_Suji" }

    aURL = "https://www.aptrank.kr" + "?reg=" + selectedRegion +"&sub=" + to_subRegion
    if ( navigator.platform ) {
        if ( pcDevice.indexOf(navigator.platform.toLowerCase()) < 0 ) {
          location.href = aURL
        } else {
          window.open(aURL)
        }
    }    
  }
</script>
</html>
